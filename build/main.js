var me=Object.defineProperty,xn=Object.defineProperties,An=Object.getOwnPropertyDescriptor,Tn=Object.getOwnPropertyDescriptors,Nn=Object.getOwnPropertyNames,Xe=Object.getOwnPropertySymbols;var Ye=Object.prototype.hasOwnProperty,Cn=Object.prototype.propertyIsEnumerable;var wn=(e,n)=>(n=Symbol[e])?n:Symbol.for("Symbol."+e);var Ie=(e,n,t)=>n in e?me(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,$=(e,n)=>{for(var t in n||(n={}))Ye.call(n,t)&&Ie(e,t,n[t]);if(Xe)for(var t of Xe(n))Cn.call(n,t)&&Ie(e,t,n[t]);return e},Ke=(e,n)=>xn(e,Tn(n));var x=(e,n)=>()=>(e&&(n=e(e=0)),n);var ee=(e,n)=>{for(var t in n)me(e,t,{get:n[t],enumerable:!0})},En=(e,n,t,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of Nn(n))!Ye.call(e,i)&&i!==t&&me(e,i,{get:()=>n[i],enumerable:!(o=An(n,i))||o.enumerable});return e};var In=e=>En(me({},"__esModule",{value:!0}),e);var E=(e,n,t)=>Ie(e,typeof n!="symbol"?n+"":n,t);var Y=function(e,n){this[0]=e,this[1]=n},ge=(e,n,t)=>{var o=(r,a,l,u)=>{try{var c=t[r](a),d=(a=c.value)instanceof Y,m=c.done;Promise.resolve(d?a[0]:a).then(g=>d?o(r==="return"?r:"next",a[1]?{done:g.done,value:g.value}:g,l,u):l({value:g,done:m})).catch(g=>o("throw",g,l,u))}catch(g){u(g)}},i=r=>s[r]=a=>new Promise((l,u)=>o(r,a,l,u)),s={};return t=t.apply(e,n),s[wn("asyncIterator")]=()=>s,i("next"),i("throw"),i("return"),s};function v(e,n){let t=`${Qe}`;return Qe+=1,te[t]={handler:n,name:e},function(){delete te[t]}}function Re(e,n){let t=!1;return v(e,function(...o){t!==!0&&(t=!0,n(...o))})}function Ze(e,n){let t=!1;for(let o in te)te[o].name===e&&(te[o].handler.apply(null,n),t=!0);if(t===!1)throw new Error(`No event handler with name \`${e}\``)}var te,Qe,et=x(()=>{te={},Qe=0;typeof window=="undefined"?figma.ui.onmessage=function(e){if(!Array.isArray(e))return;let[n,...t]=e;typeof n=="string"&&Ze(n,t)}:window.onmessage=function(e){if(typeof e.data.pluginMessage=="undefined")return;let n=e.data.pluginMessage;if(!Array.isArray(n))return;let[t,...o]=e.data.pluginMessage;typeof t=="string"&&Ze(t,o)}});function ve(e,n){if(typeof __html__=="undefined")throw new Error("No UI defined");let t=`<div id="create-figma-plugin"></div><script>document.body.classList.add('theme-${figma.editorType}');const __FIGMA_COMMAND__='${typeof figma.command=="undefined"?"":figma.command}';const __SHOW_UI_DATA__=${JSON.stringify(typeof n=="undefined"?{}:n)};${__html__}</script>`;figma.showUI(t,Ke($({},e),{themeColors:typeof e.themeColors=="undefined"?!0:e.themeColors}))}var tt=x(()=>{});var nt=x(()=>{et();tt()});var ot,rt=x(()=>{"use strict";ot={codeName:"figmai_plugin",brandName:"FigmAI"}});var z,fe=x(()=>{"use strict";z={provider:"openai",features:{enableToolCalls:!0,enableVision:!1,enableSelectionExportPng:!1},defaultMode:"advanced",dev:{enableContentTableValidationLogging:!1,enableClipboardDebugLogging:!1}}});function Me(e){return pe.find(n=>n.id===e)}function Oe(e){return e==="simple"&&pe.find(t=>t.id==="general")||pe[0]}var it,Rn,pe,st=x(()=>{"use strict";it=`# General Assistant

You are FigmAI, a helpful AI assistant integrated into Figma to help designers with their work.

## Your Role

- Answer questions about design principles, best practices, and Figma usage
- Provide guidance on layout, typography, color, and spacing
- Help with design workflows and tool usage
- Offer constructive feedback and suggestions
- Explain design decisions and concepts

## Guidelines

- Be concise but thorough
- Use design terminology appropriately
- Reference Figma-specific features when relevant
- Provide actionable advice when possible
- Be supportive and encouraging

## Context

When a user shares their selection, you can see information about the selected Figma nodes including:
- Node types (frames, text, rectangles, etc.)
- Names and dimensions
- Layout properties (for frames)
- Text content and styling (for text nodes)

Use this context to provide relevant, specific feedback.`,Rn=`# Design Critique Assistant

**CRITICAL**: Return ONLY valid JSON. Do not wrap in \`\`\` fences. Do not include any other text.

You are **FigmAI's Design Critique Assistant**, an expert UX and UI design reviewer embedded inside a Figma plugin.
You will receive one or more images of a UI design exported directly from Figma.
Your purpose is to evaluate the user's selected frame or element on the Figma canvas and provide clear, structured, and actionable critique grounded in proven UX, UI, and product design principles.

[Full knowledge base available in: src/assistants/designCritique.md]

## Output Format (STRICT)

You MUST respond with valid JSON in this exact format (NO markdown fences, NO other text):

{
  "score": 85,
  "summary": "1-2 sentences summarizing the overall design quality and key findings",
  "wins": ["Primary CTA is visually dominant and clearly separated from secondary actions", "Consistent spacing system creates clear visual hierarchy"],
  "fixes": ["Increase text contrast for body text to meet WCAG AA (currently #666, suggest #333)", "Add 8px spacing between related form fields to improve grouping", "Make interactive elements more obvious with hover states"],
  "checklist": ["Primary action is visually dominant", "Related elements are grouped using spacing", "Interactive elements look interactive", "Text is readable without zooming", "Color contrast meets WCAG AA standards"],
  "notes": []
}

**Required fields**:
- score: Integer 0-100 (required)
- summary: String (required, can be empty string)
- wins: Array of strings (required, can be empty array)
- fixes: Array of strings (required, can be empty array)
- checklist: Array of strings (optional, can be empty array)
- notes: Array of strings (optional, can be empty array or omitted)

**Rules**:
- NO markdown code fences (\`\`\`json or \`\`\`)
- NO leading or trailing text
- NO commentary or explanations
- NO whitespace before { or after }
- ONLY the raw JSON object

Scoring: 90-100 (exceptional), 80-89 (strong), 70-79 (solid), 60-69 (functional), Below 60 (major issues).

Evaluate: Hierarchy, Layout, Spacing, Typography, Color/Contrast, Affordance, Consistency, Accessibility, States.

**CRITICAL**: Return ONLY valid JSON. Do not wrap in \`\`\` fences. Do not include any other text.`,pe=[{id:"general",label:"General",intro:"I'm your general design assistant. Ask me anything about design, Figma, or your current work.",promptMarkdown:it,iconId:"AskIcon",kind:"ai",quickActions:[{id:"explain",label:"Explain this design",templateMessage:"Can you explain this design to me? What are the key elements and their purpose?",requiresSelection:!1},{id:"suggestions",label:"Design suggestions",templateMessage:"What suggestions do you have to improve this design?",requiresSelection:!1}]},{id:"content_table",label:"Content Table",intro:"I generate structured content inventories and tables from your designs. Select a single container to scan all text content.",promptMarkdown:`# Content Table Assistant

You are **FigmAI's Content Table Assistant**, a content strategist and information architect embedded inside a Figma plugin.
You generate structured content inventories and tables that help teams track, organize, and manage all text content in their designs.

[Full knowledge base available in: src/assistants/contentTable.md]`,iconId:"ContentTableIcon",kind:"tool",quickActions:[{id:"generate-table",label:"GENERATE TABLE",templateMessage:"Scan selected container and generate content table",requiresSelection:!0}]},{id:"ux_copy_review",label:"Content Review",intro:"I review and improve text content for clarity, tone, and UX effectiveness. Select text layers to analyze copy.",promptMarkdown:`# Content Review Assistant

You are **FigmAI's Content Review Assistant**, an expert content strategist and UX writer embedded inside a Figma plugin.
You specialize in evaluating and improving text content for clarity, tone, user experience effectiveness, and conversion optimization.

[Full knowledge base available in: src/assistants/uxCopyReview.md]`,iconId:"SpellCheckIcon",kind:"ai",quickActions:[{id:"review-copy",label:"Review copy",templateMessage:"Review the selected text content for clarity, tone, conciseness, and actionability. Provide structured feedback with scores and specific suggestions.",requiresSelection:!0},{id:"tone-check",label:"Tone check",templateMessage:"Analyze the tone of the selected copy. Is it appropriate for the context and target audience?",requiresSelection:!0},{id:"content-suggestions",label:"Content suggestions",templateMessage:"What improvements can be made to the copy? Focus on clarity, user-centered language, and actionability.",requiresSelection:!1}]},{id:"design_critique",label:"Design Critique",intro:"I provide detailed design critiques with scores, wins, fixes, and actionable feedback. Select a design element to get started.",promptMarkdown:Rn,iconId:"ArtIcon",kind:"ai",quickActions:[{id:"give-critique",label:"Give Design Crit",templateMessage:"Provide a comprehensive design critique of the selected elements.",requiresSelection:!0,requiresVision:!0,maxImages:1,imageScale:2}]},{id:"code2design",label:"Code2Design",intro:"Import/export JSON templates to create and manage Figma designs.",promptMarkdown:it,iconId:"CodeIcon",kind:"hybrid",quickActions:[{id:"send-json",label:"SEND JSON",templateMessage:"Paste a FigmAI Template JSON to generate Figma elements",requiresSelection:!1},{id:"get-json",label:"GET JSON",templateMessage:"Export selected frames to JSON template format",requiresSelection:!0},{id:"json-format-help",label:"How to format JSON",templateMessage:"Explain the FigmAI Template JSON format and schema requirements",requiresSelection:!1}]},{id:"dev_handoff",label:"Dev Handoff",intro:"I generate developer-friendly specifications and documentation from your designs. Select frames or components to get started.",promptMarkdown:`# Dev Handoff Assistant

You are **FigmAI's Dev Handoff Assistant**, a technical documentation specialist embedded inside a Figma plugin.
You generate developer-friendly specifications, measurements, and implementation guidance from Figma designs.

[Full knowledge base available in: src/assistants/devHandoff.md]`,iconId:"CodeIcon",kind:"ai",quickActions:[{id:"generate-specs",label:"Generate specs",templateMessage:"Generate comprehensive developer specifications including layout, typography, colors, components, interactions, and accessibility requirements.",requiresSelection:!0,requiresVision:!0,maxImages:1,imageScale:2},{id:"export-measurements",label:"Export measurements",templateMessage:"Export all measurements, spacing, and sizing information for the selected elements.",requiresSelection:!0},{id:"component-details",label:"Component details",templateMessage:"Provide detailed component specifications including variants, states, and implementation notes.",requiresSelection:!0}]},{id:"accessibility",label:"Accessibility",intro:"I help ensure your designs are accessible and inclusive. Select elements to check for accessibility issues.",promptMarkdown:`# Accessibility Assistant

You are **FigmAI's Accessibility Assistant**, an expert in inclusive design and WCAG compliance embedded inside a Figma plugin.
You specialize in identifying accessibility barriers and providing specific, actionable fixes to make designs usable by everyone.

[Full knowledge base available in: src/assistants/accessibility.md]`,iconId:"ADAIcon",kind:"ai",quickActions:[{id:"check-a11y",label:"Check accessibility",templateMessage:"Review this design for accessibility issues. Check color contrast, text sizing, interactive elements, and WCAG compliance.",requiresSelection:!0,requiresVision:!0,maxImages:1,imageScale:2},{id:"wcag-compliance",label:"WCAG compliance",templateMessage:"Check WCAG AA/AAA compliance. Identify all violations and provide specific fixes with contrast ratios and measurements.",requiresSelection:!0,requiresVision:!0,maxImages:1,imageScale:2},{id:"contrast-analysis",label:"Color contrast analysis",templateMessage:"Analyze color contrast for all text/background combinations. Calculate contrast ratios and identify issues.",requiresSelection:!0,requiresVision:!0,maxImages:1,imageScale:2}]},{id:"errors",label:"Errors",intro:"I identify design errors, inconsistencies, and quality issues. Select elements to find problems before handoff.",promptMarkdown:`# Errors Assistant

You are **FigmAI's Errors Assistant**, a design quality assurance specialist embedded inside a Figma plugin.
You identify design errors, inconsistencies, and quality issues that could cause problems in implementation or user experience.

[Full knowledge base available in: src/assistants/errors.md]`,iconId:"CautionIcon",kind:"ai",quickActions:[{id:"find-errors",label:"Find errors",templateMessage:"Identify all design errors including layout issues, inconsistencies, component misuse, missing states, and naming problems.",requiresSelection:!0,requiresVision:!0,maxImages:1,imageScale:2},{id:"check-consistency",label:"Check consistency",templateMessage:"Check for style inconsistencies in spacing, colors, typography, and component usage across the design.",requiresSelection:!0,requiresVision:!0,maxImages:1,imageScale:2}]}]});function vn(e,n){if(!e||e.length===0||!n.supportsImages)return;let t=e;n.maxImages!==void 0&&e.length>n.maxImages&&(t=e.slice(0,n.maxImages));let o=[];for(let i of t)!i.dataUrl||typeof i.dataUrl!="string"||i.dataUrl.startsWith("data:")&&o.push({dataUrl:i.dataUrl,name:i.name,width:i.width,height:i.height});return o.length>0?o:void 0}function ye(e){return e.filter(n=>n&&n.role&&n.content).map(n=>({role:Mn(n.role),content:String(n.content).trim()})).filter(n=>n.content.length>0)}function Mn(e){let n=e.toLowerCase().trim();return n==="user"||n==="assistant"||n==="system"?n:"user"}function he(e,n){let t={messages:ye(e.messages),assistantId:e.assistantId,assistantName:e.assistantName,quickActionId:e.quickActionId,selection:e.selection,selectionSummary:e.selectionSummary,quickAction:e.quickAction};return t.images=vn(e.images,n),t}function at(e){if(typeof e=="string")return e;if(e&&typeof e=="object"){let n=e;if(typeof n.text=="string")return n.text;if(typeof n.content=="string")return n.content;if(typeof n.message=="string")return n.message;if(typeof n.response=="string")return n.response;if(n.choices&&Array.isArray(n.choices)&&n.choices.length>0){let t=n.choices[0];if(t&&typeof t=="object"){let o=t;if(o.message&&typeof o.message=="object"){let i=o.message;if(typeof i.content=="string")return i.content}if(typeof o.text=="string")return o.text}}try{let t=JSON.stringify(e);if(t.length<1e3)return t}catch(t){}}return String(e)}var ne=x(()=>{"use strict"});var lt={};ee(lt,{StubProvider:()=>oe});var oe,ke=x(()=>{"use strict";ne();oe=class{constructor(){E(this,"id","stub");E(this,"label","Stub (Development)");E(this,"isEnabled",!0);E(this,"capabilities",{supportsImages:!0,supportsMarkdown:!0,requiresStrictSchema:!1})}async sendChat(n){var s;let t=he(n,this.capabilities);await new Promise(r=>setTimeout(r,500));let o=[];t.assistantName&&o.push(`[${t.assistantName} Assistant]`),(s=t.selection)!=null&&s.hasSelection&&(o.push(`I can see you have ${t.selection.count} item(s) selected.`),t.selection.summary&&o.push(`Summary: ${t.selection.summary}`)),t.images&&t.images.length>0&&o.push(`Received ${t.images.length} image(s) for analysis.`),t.quickAction&&o.push(`Quick action "${t.quickAction}" was triggered.`);let i=t.messages.filter(r=>r.role==="user").pop();return i?(o.push(`

You asked: "${i.content}"`),o.push(`

This is a stub response. In production, this would be replaced with actual AI responses from the configured provider.`)):o.push(`

This is a stub response from the development provider.`),o.join(`
`)}async testConnection(){return{success:!0,message:"Stub provider is always available (development mode)"}}sendChatStream(n){return ge(this,null,function*(){let o=(yield new Y(this.sendChat(n))).split(" ");for(let i of o)yield new Y(new Promise(s=>setTimeout(s,50))),yield i+" "})}}});function ut(e){return e.trim().replace(/\/+$/,"")}async function P(){try{let e=await figma.clientStorage.getAsync(dt);if(e){let n=$($({},ct),e);return n.proxyBaseUrl&&(n.proxyBaseUrl=ut(n.proxyBaseUrl)),n}}catch(e){console.warn("[Settings] Failed to load from storage:",e)}return $({},ct)}async function mt(e){try{let n=await P(),t=$($({},n),e);t.proxyBaseUrl&&(t.proxyBaseUrl=ut(t.proxyBaseUrl)),await figma.clientStorage.setAsync(dt,t)}catch(n){throw console.error("[Settings] Failed to save:",n),n}}var dt,ct,re=x(()=>{"use strict";dt="figmai_settings",ct={proxyBaseUrl:"",authMode:"shared_token",defaultModel:"gpt-4.1-mini",requestTimeoutMs:3e4}});var _,ie=x(()=>{"use strict";_=class extends Error{constructor(t,o,i,s,r){super(t);this.type=o;this.statusCode=i;this.responseBody=s;this.retryable=r;this.name="ProviderError"}isRetryable(){return this.retryable!==void 0?this.retryable:this.type==="network"||this.type==="timeout"||this.type==="provider_error"&&this.statusCode!==void 0&&this.statusCode>=500}}});function L(...e){On&&console.log("[ProxyClient]",...e)}async function gt(e,n,t){if(!(typeof AbortController!="undefined")||!t||t<=0)return fetch(e,n);let i=new AbortController,s=setTimeout(()=>i.abort(),t);try{let r={method:n.method,headers:n.headers,body:n.body,signal:i.signal};return await fetch(e,r)}finally{clearTimeout(s)}}function ft(e){if(e instanceof Error)return e.message;if(e&&typeof e=="object"&&"status"in e&&"statusText"in e){let n=e;return`HTTP ${n.status}: ${n.statusText}`}if(e&&typeof e=="object")try{let n=JSON.stringify(e,null,2);return n.length>500?n.substring(0,500)+"...":n}catch(n){return String(e)}return String(e)}var On,U,De,Le,pt=x(()=>{"use strict";re();ie();ne();On=!1;U=class e extends _{constructor(n,t="unknown",o,i,s){super(n,t,o,i,s),this.name="ProxyError"}static fromResponse(n,t,o){let i,s;n===401||n===403?(i="authentication",s=!1):n===429?(i="rate_limit",s=!0):n>=400&&n<500?(i="invalid_request",s=!1):n>=500?(i="provider_error",s=!0):i="unknown";let r=`Proxy request failed: ${n} ${t}${o?`. ${o}`:""}`;return new e(r,i,n,o,s)}static fromNetworkError(n){return n.name==="AbortError"?new e("Request timeout. The proxy server took too long to respond.","timeout",void 0,void 0,!0):new e(`Failed to communicate with proxy: ${n.message}`,"network",void 0,void 0,!0)}},De=class{normalizeProxyBaseUrl(n){return n.trim().replace(/\/+$/,"")}async getAuthHeaders(){let n=await P(),t={"Content-Type":"application/json",Accept:"application/json"};return n.authMode==="shared_token"&&n.sharedToken?t["X-FigmAI-Token"]=n.sharedToken:n.authMode==="session_token"&&n.sessionToken&&(t.Authorization=`Bearer ${n.sessionToken}`),t}async healthCheck(){let n=await P();if(!n.proxyBaseUrl)return{success:!1,message:"Proxy base URL not configured"};let o=`${this.normalizeProxyBaseUrl(n.proxyBaseUrl)}/health`;L("Health check:",o);try{let i=Date.now(),s=await gt(o,{method:"GET",headers:{Accept:"application/json"}},5e3),r=Date.now()-i;if(s.ok){try{let a=await s.json();L("Health check response:",a)}catch(a){}return{success:!0,message:`Connection successful (${r}ms)`,latency:r}}else{let a="";try{a=await s.text()}catch(l){a="Unable to read error response"}return{success:!1,message:`Connection failed: ${s.status} ${s.statusText}${a?`. ${a}`:""}`}}}catch(i){return L("Health check error:",i),i instanceof Error&&i.name==="AbortError"?{success:!1,message:"Connection timeout. The proxy server took too long to respond."}:{success:!1,message:`Could not connect to proxy: ${ft(i)}`}}}async chat(n,t={}){var u,c;let o=await P();if(!o.proxyBaseUrl)throw new U("Proxy base URL not configured. Please set it in Settings.");let s=`${this.normalizeProxyBaseUrl(o.proxyBaseUrl)}/v1/chat`,r=await this.getAuthHeaders(),a={model:t.model||o.defaultModel,messages:n.map(d=>({role:d.role,content:d.content}))};t.assistantId&&(a.assistantId=t.assistantId),t.quickActionId&&(a.quickActionId=t.quickActionId);let l=t.assistantId==="design_critique"||t.quickActionId==="give-critique";if(l?(a.response_format={type:"json_object"},L("Enforcing JSON output for Design Critique (json_object mode)"),console.log("[DC] assistantId=",t.assistantId,"quickActionId=",t.quickActionId,"response_format=json_object"),console.log("[DC] DC_JSON_MODE_ENABLED=true")):console.log("[DC] DC_JSON_MODE_ENABLED=false (not a Design Critique request)"),l){let d={assistantId:t.assistantId,quickActionId:t.quickActionId,response_format:a.response_format,model:a.model,messageCount:n.length,hasSelectionSummary:!!t.selectionSummary,imageCount:((u=t.images)==null?void 0:u.length)||0};console.log("[DC] REQUEST_PAYLOAD",d)}t.selectionSummary?(a.selectionSummary=t.selectionSummary,L("Selection summary included:",t.selectionSummary.substring(0,200)+"...")):L("No selection summary provided"),t.images&&t.images.length>0?(a.images=t.images.map(d=>({dataUrl:d.dataUrl,name:d.name,width:d.width,height:d.height})),L(`Images included: ${t.images.length} image(s)`),t.images.forEach((d,m)=>{let g=d.dataUrl.substring(0,80)+"...";L(`  Image ${m+1}: ${d.name||"Unnamed"}, ${d.width}x${d.height}, base64 preview: ${g}`)})):L("No images provided"),L("Chat request:",{url:s,model:a.model,messageCount:n.length,hasSelectionSummary:!!t.selectionSummary,imageCount:((c=t.images)==null?void 0:c.length)||0});try{let d=await gt(s,{method:"POST",headers:r,body:JSON.stringify(a)},o.requestTimeoutMs);if(!d.ok){let f="";try{f=await d.text()}catch(S){f="Unable to read error response"}throw new U(`Proxy request failed: ${d.status} ${d.statusText}${f?`. ${f}`:""}`,"unknown",d.status,f)}let m;try{m=await d.json()}catch(f){try{let S=await d.text();if(S)return S}catch(S){}throw new U("Invalid response format from proxy: expected JSON or text","invalid_request",d.status)}let g=at(m);if(!g)throw new U("Empty response from proxy","invalid_request",d.status);if(t.assistantId==="design_critique"||t.quickActionId==="give-critique"){console.log("[DC] RAW_RESPONSE_HEAD",g.slice(0,120)),console.log("[DC] RAW_RESPONSE_LENGTH",g.length);let f=g.trim();f=f.replace(/^```json\s*/i,"").replace(/^```\s*/i,"").replace(/\s*```$/i,"");try{JSON.parse(f),L("Design Critique response validated as JSON"),console.log("[DC] JSON_VALIDATION",{status:"PASS"})}catch(S){let b=g.substring(0,500);console.warn("[ProxyClient] Design Critique response is not valid JSON. First 500 chars:",b),L("Design Critique response failed JSON validation - plugin will handle fallback"),console.log("[DC] JSON_VALIDATION",{status:"FAIL",error:S instanceof Error?S.message:String(S)})}}return g}catch(d){throw d instanceof U?d:d instanceof Error?d.name==="AbortError"?new U("Request timeout. The proxy server took too long to respond.","timeout"):new U(`Failed to communicate with proxy: ${d.message}`,"network"):new U(`Failed to communicate with proxy: ${ft(d)}`,"unknown")}}},Le=new De});var se,yt=x(()=>{"use strict";pt();re();ne();se=class{constructor(){E(this,"id","openai");E(this,"label","OpenAI");E(this,"isEnabled",!0);E(this,"capabilities",{supportsImages:!0,supportsMarkdown:!0,requiresStrictSchema:!1,maxImages:void 0})}async sendChat(n){let t=await P(),o=he(n,this.capabilities),i=o.messages.map(s=>({role:s.role,content:s.content}));return await Le.chat(i,{model:t.defaultModel,assistantId:o.assistantId,quickActionId:o.quickActionId,selectionSummary:o.selectionSummary,images:o.images})}async testConnection(){return await Le.healthCheck()}sendChatStream(n){return ge(this,null,function*(){yield yield new Y(this.sendChat(n))})}}});var Se,ht=x(()=>{"use strict";ie();Se=class{constructor(){E(this,"id","claude");E(this,"label","Claude (Coming soon)");E(this,"isEnabled",!1);E(this,"capabilities",{supportsImages:!0,supportsMarkdown:!0,requiresStrictSchema:!1})}async sendChat(n){throw new _("Claude provider is not yet implemented","invalid_request")}async testConnection(){return{success:!1,message:"Claude provider is not yet implemented"}}}});var be,St=x(()=>{"use strict";ie();be=class{constructor(){E(this,"id","copilot");E(this,"label","Copilot (Coming soon)");E(this,"isEnabled",!1);E(this,"capabilities",{supportsImages:!1,supportsMarkdown:!1,requiresStrictSchema:!0})}async sendChat(n){throw new _("Copilot provider is not yet implemented","invalid_request")}async testConnection(){return{success:!1,message:"Copilot provider is not yet implemented"}}}});async function B(e){let n=e||z.provider;if((await P()).proxyBaseUrl)return new se;switch(n){case"openai":return new se;case"claude":return new Se;case"copilot":return new be;default:return new oe}}var bt=x(()=>{"use strict";ke();yt();ht();St();fe();re()});var Fe,$e,xt=x(()=>{"use strict";Fe={id:"ANNOTATE_SELECTION",name:"Annotate Selection",description:"Adds annotation notes near selected nodes",requiresSelection:!0,async execute(e,n){if(!(n!=null&&n.hasSelection))return"Error: Selection required for annotation tool";let t=figma.currentPage.selection;if(t.length===0)return"Error: No nodes selected";let o=e.text||"Annotation",i=[];for(let s of t){let r=figma.createText();try{await figma.loadFontAsync({family:"Inter",style:"Regular"}),r.fontName={family:"Inter",style:"Regular"},r.fontSize=12,r.characters=o,r.fills=[{type:"SOLID",color:{r:.2,g:.2,b:.2}}],r.x=s.x+s.width+10,r.y=s.y,figma.currentPage.appendChild(r),i.push(r)}catch(a){console.warn("Failed to create annotation:",a)}}return i.length>0?(figma.currentPage.selection=i,`Successfully added ${i.length} annotation(s)`):"Failed to create annotations"}},$e={id:"CREATE_CHECKLIST_FRAME",name:"Create Checklist Frame",description:"Creates a new auto-layout frame with checklist items",requiresSelection:!1,async execute(e){let n=e.items||["Item 1","Item 2","Item 3"],t=figma.createFrame();t.name="Checklist",t.layoutMode="VERTICAL",t.paddingLeft=16,t.paddingRight=16,t.paddingTop=16,t.paddingBottom=16,t.itemSpacing=8,t.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}];try{await figma.loadFontAsync({family:"Inter",style:"Regular"});for(let o of n){let i=figma.createText();i.fontName={family:"Inter",style:"Regular"},i.fontSize=14,i.characters=`\u2610 ${o}`,i.fills=[{type:"SOLID",color:{r:0,g:0,b:0}}],t.appendChild(i)}return t.x=figma.viewport.center.x-100,t.y=figma.viewport.center.y-100,figma.currentPage.appendChild(t),figma.currentPage.selection=[t],figma.viewport.scrollAndZoomIntoView([t]),`Successfully created checklist frame with ${n.length} item(s)`}catch(o){return`Error creating checklist: ${o}`}}}});function kn(e){let n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16)/255,g:parseInt(n[2],16)/255,b:parseInt(n[3],16)/255}:null}function At(e){return e.hex?kn(e.hex):e.r!==void 0&&e.g!==void 0&&e.b!==void 0?{r:Math.max(0,Math.min(1,e.r)),g:Math.max(0,Math.min(1,e.g)),b:Math.max(0,Math.min(1,e.b))}:null}function Tt(e,n,t,o,i){if(n>12)return o.push(`${i}: Maximum depth of 12 exceeded`),!1;if(t.count>300)return o.push(`${i}: Maximum node count of 300 exceeded`),!1;if(typeof e!="object"||e===null)return o.push(`${i}: Must be an object`),!1;let s=e;if(typeof s.type!="string")return o.push(`${i}.type: Must be a string`),!1;if(!["FRAME","TEXT","RECTANGLE"].includes(s.type))return o.push(`${i}.type: Must be one of FRAME, TEXT, RECTANGLE`),!1;if(t.count++,s.type==="TEXT"){if(!s.text||typeof s.text!="object")return o.push(`${i}.text: TEXT nodes require a text object`),!1;let r=s.text;if(typeof r.value!="string")return o.push(`${i}.text.value: Must be a string`),!1;if(r.fontSize!==void 0&&(typeof r.fontSize!="number"||r.fontSize<1||r.fontSize>500))return o.push(`${i}.text.fontSize: Must be a number between 1 and 500`),!1}if(s.type==="FRAME"){if(s.layout!==void 0){if(typeof s.layout!="object"||s.layout===null)return o.push(`${i}.layout: Must be an object`),!1;if(s.layout.mode!=="AUTO_LAYOUT")return o.push(`${i}.layout.mode: Must be AUTO_LAYOUT`),!1}if(s.children!==void 0){if(!Array.isArray(s.children))return o.push(`${i}.children: Must be an array`),!1;for(let r=0;r<s.children.length;r++)Tt(s.children[r],n+1,t,o,`${i}.children[${r}]`)}}if(s.style!==void 0){if(typeof s.style!="object"||s.style===null)return o.push(`${i}.style: Must be an object`),!1;let r=s.style;if(r.fills!==void 0){if(!Array.isArray(r.fills))return o.push(`${i}.style.fills: Must be an array`),!1;for(let a=0;a<r.fills.length;a++){let l=r.fills[a];if(l.type!=="SOLID")return o.push(`${i}.style.fills[${a}].type: Must be SOLID`),!1;if(!l.color||typeof l.color!="object")return o.push(`${i}.style.fills[${a}].color: Must be an object`),!1;let u=l.color;if(!At(u))return o.push(`${i}.style.fills[${a}].color: Invalid color format`),!1}}if(r.radius!==void 0&&(typeof r.radius!="number"||r.radius<0||r.radius>1e3))return o.push(`${i}.style.radius: Must be a number between 0 and 1000`),!1}return!0}function Nt(e){let n=[],t;try{t=JSON.parse(e)}catch(o){return{ok:!1,errors:[`Invalid JSON: ${o}`]}}if(typeof t.schemaVersion!="string"?n.push("schemaVersion: Must be a string"):t.schemaVersion!=="1.0"&&n.push('schemaVersion: Must be "1.0"'),!t.root)n.push("root: Required");else{let o={count:0};Tt(t.root,0,o,n,"root")}return n.length>0?{ok:!1,errors:n,summary:`Validation failed with ${n.length} error(s)`}:{ok:!0,errors:[],summary:"Template is valid"}}function K(e){let n=At(e);return n||{r:0,g:0,b:0}}var Ct=x(()=>{"use strict"});async function wt(e,n,t){let o=e.type;if(n[o]||(n[o]=0),n[o]++,o==="FRAME"){let i=figma.createFrame();if(i.name=e.name||"Frame",e.layout&&(i.layoutMode=e.layout.direction==="HORIZONTAL"?"HORIZONTAL":"VERTICAL",e.layout.padding&&(i.paddingLeft=e.layout.padding.left||0,i.paddingRight=e.layout.padding.right||0,i.paddingTop=e.layout.padding.top||0,i.paddingBottom=e.layout.padding.bottom||0),e.layout.gap!==void 0&&(i.itemSpacing=e.layout.gap),e.layout.sizing&&(typeof e.layout.sizing.width=="number"&&i.resize(e.layout.sizing.width,i.height),typeof e.layout.sizing.height=="number"&&i.resize(i.width,e.layout.sizing.height))),e.style){if(e.style.fills&&e.style.fills.length>0){let s=e.style.fills[0],r=K(s.color);i.fills=[{type:"SOLID",color:r}]}if(e.style.strokes&&e.style.strokes.length>0){let s=e.style.strokes[0],r=K(s.color);i.strokes=[{type:"SOLID",color:r}],i.strokeWeight=s.weight||1}e.style.radius!==void 0&&(i.cornerRadius=e.style.radius)}if(e.children)for(let s of e.children){let r=await wt(s,n,t);r&&i.appendChild(r)}return t.push(i),i}if(o==="TEXT"){let i=figma.createText();if(i.name=e.name||"Text",!e.text)return null;let s=e.text.fontFamily||"Inter",r=e.text.fontStyle||"Regular";try{await figma.loadFontAsync({family:s,style:r}),i.fontName={family:s,style:r}}catch(a){try{await figma.loadFontAsync({family:"Inter",style:"Regular"}),i.fontName={family:"Inter",style:"Regular"}}catch(l){return null}}if(i.characters=e.text.value,i.fontSize=e.text.fontSize||14,e.style&&e.style.fills&&e.style.fills.length>0){let a=e.style.fills[0],l=K(a.color);i.fills=[{type:"SOLID",color:l}]}return t.push(i),i}if(o==="RECTANGLE"){let i=figma.createRectangle();if(i.name=e.name||"Rectangle",i.resize(100,100),e.style){if(e.style.fills&&e.style.fills.length>0){let s=e.style.fills[0],r=K(s.color);i.fills=[{type:"SOLID",color:r}]}if(e.style.strokes&&e.style.strokes.length>0){let s=e.style.strokes[0],r=K(s.color);i.strokes=[{type:"SOLID",color:r}],i.strokeWeight=s.weight||1}e.style.radius!==void 0&&(i.cornerRadius=e.style.radius)}return t.push(i),i}return null}function _e(e){if(e.type==="FRAME"){let n={type:"FRAME",name:e.name};e.layoutMode!=="NONE"&&(n.layout={mode:"AUTO_LAYOUT",direction:e.layoutMode==="HORIZONTAL"?"HORIZONTAL":"VERTICAL",padding:{top:e.paddingTop,right:e.paddingRight,bottom:e.paddingBottom,left:e.paddingLeft},gap:e.itemSpacing,sizing:{width:e.width,height:e.height}});let t={};if(e.fills&&Array.isArray(e.fills)&&e.fills.length>0){let o=e.fills[0];o.type==="SOLID"&&(t.fills=[{type:"SOLID",color:{r:o.color.r,g:o.color.g,b:o.color.b}}])}if(e.strokes&&Array.isArray(e.strokes)&&e.strokes.length>0){let o=e.strokes[0];o.type==="SOLID"&&(t.strokes=[{type:"SOLID",color:{r:o.color.r,g:o.color.g,b:o.color.b},weight:e.strokeWeight}])}return e.cornerRadius!==void 0&&typeof e.cornerRadius=="number"&&(t.radius=e.cornerRadius),Object.keys(t).length>0&&(n.style=t),e.children&&e.children.length>0&&(n.children=e.children.map(o=>_e(o)).filter(o=>o!==null)),n}if(e.type==="TEXT"){let n={type:"TEXT",name:e.name,text:{value:e.characters,fontSize:typeof e.fontSize=="number"?e.fontSize:void 0,fontFamily:e.fontName&&typeof e.fontName!="symbol"?e.fontName.family:void 0,fontStyle:e.fontName&&typeof e.fontName!="symbol"?e.fontName.style:void 0}},t={};if(e.fills&&Array.isArray(e.fills)&&e.fills.length>0){let o=e.fills[0];o.type==="SOLID"&&(t.fills=[{type:"SOLID",color:{r:o.color.r,g:o.color.g,b:o.color.b}}])}return Object.keys(t).length>0&&(n.style=t),n}if(e.type==="RECTANGLE"){let n={type:"RECTANGLE",name:e.name},t={};if(e.fills&&Array.isArray(e.fills)&&e.fills.length>0){let o=e.fills[0];o.type==="SOLID"&&(t.fills=[{type:"SOLID",color:{r:o.color.r,g:o.color.g,b:o.color.b}}])}if(e.strokes&&Array.isArray(e.strokes)&&e.strokes.length>0){let o=e.strokes[0];o.type==="SOLID"&&(t.strokes=[{type:"SOLID",color:{r:o.color.r,g:o.color.g,b:o.color.b},weight:e.strokeWeight}])}return e.cornerRadius!==void 0&&typeof e.cornerRadius=="number"&&(t.radius=e.cornerRadius),Object.keys(t).length>0&&(n.style=t),n}return null}var Ue,qe,Et=x(()=>{"use strict";Ct();Ue={id:"CREATE_FROM_TEMPLATE_JSON",name:"Create From Template JSON",description:"Creates Figma elements from a JSON template",requiresSelection:!1,async execute(e){let n=e.rawJson;if(!n||typeof n!="string")return"Error: rawJson parameter is required";let t=Nt(n);if(!t.ok)return`Validation failed:
${t.errors.join(`
`)}`;let o;try{o=JSON.parse(n)}catch(r){return"Error: Failed to parse JSON"}let i={},s=[];try{let r=await wt(o.root,i,s);if(!r)return"Error: Failed to create root node";let a=figma.viewport.center;return r.x=a.x-r.width/2,r.y=a.y-r.height/2,figma.currentPage.appendChild(r),figma.currentPage.selection=[r],figma.viewport.scrollAndZoomIntoView([r]),`Successfully created ${Object.entries(i).map(([u,c])=>`${c} ${u}${c>1?"s":""}`).join(", ")}`}catch(r){return`Error creating nodes: ${r}`}}};qe={id:"EXPORT_SELECTION_TO_TEMPLATE_JSON",name:"Export Selection to Template JSON",description:"Exports selected frames to JSON template format",requiresSelection:!0,async execute(e,n){if(!(n!=null&&n.hasSelection))return"Error: Selection required for export";let t=figma.currentPage.selection;if(t.length===0)return"Error: No nodes selected";try{let o;if(t.length>1){let s=t.map(r=>_e(r));o={schemaVersion:"1.0",meta:{name:"Export"},root:{type:"FRAME",name:"Export",children:s.filter(r=>r!==null)}}}else{let s=_e(t[0]);if(!s)return"Error: Selected node cannot be exported";o={schemaVersion:"1.0",meta:{name:s.name||"Export"},root:s}}return`JSON_EXPORT:${JSON.stringify(o,null,2)}`}catch(o){return`Error exporting: ${o}`}}}});function It(e){return Dn.get(e)}var Dn,Rt=x(()=>{"use strict";xt();Et();Dn=new Map([[Fe.id,Fe],[$e.id,$e],[Ue.id,Ue],[qe.id,qe]])});async function vt(e,n){let t=It(e.name);if(!t)return`Error: Unknown tool "${e.name}"`;if(t.requiresSelection&&!(n!=null&&n.hasSelection))return`Error: Tool "${t.name}" requires a selection`;try{return await t.execute(e.arguments,n)}catch(o){return`Error executing tool "${t.name}": ${o}`}}var Mt=x(()=>{"use strict";Rt()});function W(e){let n=figma.currentPage.selection,t=n.length;if(t===0)return{count:0,summary:"No selection",hasSelection:!1,names:[]};let o=new Map;for(let l of n)o.set(l.id,l);let i=[];if(e&&e.length>0){for(let l of e){let u=o.get(l);u&&i.push(u.name||"Unnamed")}for(let l of n)e.includes(l.id)||i.push(l.name||"Unnamed")}else for(let l of n)i.push(l.name||"Unnamed");let s=new Map;for(let l of n){let u=l.type;s.set(u,(s.get(u)||0)+1)}let r=[];s.forEach((l,u)=>{r.push(`${l} ${u}${l>1?"s":""}`)});let a=r.join(", ");return{count:t,summary:a,hasSelection:!0,names:i}}var ze=x(()=>{"use strict"});function Ot(e,n=3,t=0){let o=[];if(t>=n)return o;if(e.type==="TEXT"){let s=e.characters.trim();s.length>0&&o.push(s)}if("children"in e){let i=e;for(let s of i.children)o.push(...Ot(s,n,t+1))}return o}function Pn(e){try{let n={};if(e.variantProperties&&Object.assign(n,e.variantProperties),e.componentProperties)for(let[t,o]of Object.entries(e.componentProperties))o.type==="BOOLEAN"||o.type==="TEXT"?n[t]=o.value:o.type==="INSTANCE_SWAP"?o.value&&typeof o.value=="object"&&"name"in o.value?n[t]=o.value.name:typeof o.value=="string"?n[t]=o.value:typeof o.value=="boolean"?n[t]=o.value?"True":"False":n[t]="None":o.type==="VARIANT"&&(n[t]=o.value);return Object.keys(n).length>0?n:void 0}catch(n){return}}function kt(e){let n=figma.currentPage.selection,t=n.length;if(t===0)return{count:0,nodes:[]};let o=new Map;for(let r of n)o.set(r.id,r);let i=[];if(e&&e.length>0){for(let r of e){let a=o.get(r);a&&i.push(a)}for(let r of n)e.includes(r.id)||i.push(r)}else i.push(...n);let s=i.map(r=>{let a={id:r.id,name:r.name||"Unnamed",type:r.type};if("width"in r&&"height"in r&&(a.width=Math.round(r.width),a.height=Math.round(r.height)),"x"in r&&"y"in r&&(a.x=Math.round(r.x),a.y=Math.round(r.y)),r.type==="TEXT"){let l=r,u=l.characters;if(a.textContent=u.substring(0,500),typeof l.fontSize=="number"&&(a.fontSize=Math.round(l.fontSize)),typeof l.fontName!="symbol"){a.fontFamily=`${l.fontName.family} ${l.fontName.style}`;let c=l.fontName.style.match(/(\d+)|(Bold|Regular|Light|Medium|SemiBold|Black|Thin)/i);c&&(a.fontWeight=c[0])}typeof l.lineHeight=="number"?a.lineHeight=Math.round(l.lineHeight*100)/100:l.lineHeight&&typeof l.lineHeight=="object"&&(l.lineHeight.unit==="AUTO"||"value"in l.lineHeight&&typeof l.lineHeight.value=="number"&&(a.lineHeight=Math.round(l.lineHeight.value*100)/100)),typeof l.letterSpacing=="object"&&l.letterSpacing.value!==void 0&&(a.letterSpacing=Math.round(l.letterSpacing.value*100)/100),typeof l.textAlignHorizontal=="string"&&(a.textAlign=l.textAlignHorizontal)}if(r.type==="FRAME"||r.type==="COMPONENT"||r.type==="INSTANCE"){let l=r;"children"in l&&(a.childCount=l.children.length);let u=Ot(l,3);if(u.length>0){a.hasText=!0;let c=u.join(" ").substring(0,1e3);a.allTextContent=c,!a.textContent&&u[0]&&(a.textContent=u[0].substring(0,200))}if(l.layoutMode!=="NONE"&&(a.layoutMode=l.layoutMode,typeof l.itemSpacing=="number"&&(a.itemSpacing=Math.round(l.itemSpacing)),typeof l.paddingTop=="number"&&(a.padding={top:Math.round(l.paddingTop),right:Math.round(l.paddingRight),bottom:Math.round(l.paddingBottom),left:Math.round(l.paddingLeft)}),typeof l.primaryAxisAlignItems=="string"&&(a.primaryAxisAlignItems=l.primaryAxisAlignItems),typeof l.counterAxisAlignItems=="string"&&(a.counterAxisAlignItems=l.counterAxisAlignItems),typeof l.primaryAxisSizingMode=="string"&&(a.primaryAxisSizingMode=l.primaryAxisSizingMode),typeof l.counterAxisSizingMode=="string"&&(a.counterAxisSizingMode=l.counterAxisSizingMode)),"layoutAlign"in l&&typeof l.layoutAlign=="string"&&(a.layoutAlign=l.layoutAlign),"layoutGrow"in l&&typeof l.layoutGrow=="number"&&(a.layoutGrow=l.layoutGrow),r.type==="COMPONENT")a.isComponent=!0;else if(r.type==="INSTANCE"){a.isInstance=!0;let c=r;c.mainComponent&&(a.componentName=c.mainComponent.name);let d=Pn(c);d&&(a.componentProperties=d)}}if("fills"in r&&Array.isArray(r.fills)&&r.fills.length>0){let l=[];for(let u of r.fills.slice(0,3))if(u.type==="SOLID"&&u.color){let c=Math.round(u.color.r*255),d=Math.round(u.color.g*255),m=Math.round(u.color.b*255),g=u.opacity!==void 0?Math.round(u.opacity*100)/100:1;g<1?l.push(`rgba(${c}, ${d}, ${m}, ${g})`):l.push(`rgb(${c}, ${d}, ${m})`)}l.length>0&&(a.fills=l)}if("strokes"in r&&Array.isArray(r.strokes)&&r.strokes.length>0){let l=[];for(let u of r.strokes.slice(0,2))if(u.type==="SOLID"&&u.color){let c=Math.round(u.color.r*255),d=Math.round(u.color.g*255),m=Math.round(u.color.b*255);l.push(`rgb(${c}, ${d}, ${m})`)}l.length>0&&(a.strokes=l),typeof r.strokeWeight=="number"&&(a.strokeWeight=Math.round(r.strokeWeight))}return"cornerRadius"in r&&typeof r.cornerRadius=="number"?a.cornerRadius=Math.round(r.cornerRadius):"topLeftRadius"in r&&typeof r.topLeftRadius=="number"&&(a.cornerRadius=Math.round(r.topLeftRadius)),"opacity"in r&&typeof r.opacity=="number"&&r.opacity<1&&(a.opacity=Math.round(r.opacity*100)/100),a});return{count:t,nodes:s}}function Dt(e){if(e.count===0)return"No selection";let n=[];n.push(`Selected ${e.count} node${e.count>1?"s":""}:`);for(let t of e.nodes){let o=[];if(o.push(`
${t.name} (${t.type})`),t.width&&t.height&&o.push(`Size: ${t.width}\xD7${t.height}px`),t.x!==void 0&&t.y!==void 0&&o.push(`Position: (${t.x}, ${t.y})`),t.textContent){let s=t.textContent.length>100?t.textContent.substring(0,100)+"...":t.textContent;o.push(`Text: "${s}"`)}else if(t.allTextContent){let s=t.allTextContent.length>100?t.allTextContent.substring(0,100)+"...":t.allTextContent;o.push(`Contains text: "${s}"`)}let i=[];if(t.fontSize&&i.push(`${t.fontSize}px`),t.fontFamily&&i.push(t.fontFamily),t.fontWeight&&i.push(`weight: ${t.fontWeight}`),t.lineHeight&&i.push(`line-height: ${t.lineHeight}`),t.letterSpacing&&i.push(`letter-spacing: ${t.letterSpacing}`),t.textAlign&&i.push(`align: ${t.textAlign}`),i.length>0&&o.push(`Typography: ${i.join(", ")}`),t.layoutMode){let s=[];s.push(`Layout: ${t.layoutMode}`),t.itemSpacing!==void 0&&s.push(`gap: ${t.itemSpacing}px`),t.padding&&s.push(`padding: ${t.padding.top}/${t.padding.right}/${t.padding.bottom}/${t.padding.left}px`),t.primaryAxisAlignItems&&s.push(`primary-align: ${t.primaryAxisAlignItems}`),t.counterAxisAlignItems&&s.push(`counter-align: ${t.counterAxisAlignItems}`),t.primaryAxisSizingMode&&s.push(`primary-sizing: ${t.primaryAxisSizingMode}`),t.counterAxisSizingMode&&s.push(`counter-sizing: ${t.counterAxisSizingMode}`),o.push(s.join(", "))}if(t.isComponent)o.push("Type: Component");else if(t.isInstance&&(o.push(`Type: Instance of "${t.componentName||"Unknown"}"`),t.componentProperties)){let s=Object.entries(t.componentProperties).map(([r,a])=>`${r}: ${String(a)}`).join(", ");s&&o.push(`Properties: ${s}`)}if(t.childCount!==void 0&&o.push(`Children: ${t.childCount}`),t.fills&&t.fills.length>0&&o.push(`Fill: ${t.fills.join(", ")}`),t.strokes&&t.strokes.length>0){let s=t.strokeWeight?`${t.strokes.join(", ")}, ${t.strokeWeight}px`:t.strokes.join(", ");o.push(`Stroke: ${s}`)}t.cornerRadius!==void 0&&o.push(`Corner radius: ${t.cornerRadius}px`),t.opacity!==void 0&&o.push(`Opacity: ${t.opacity}`),n.push(o.join(" | "))}return n.join(`
`)}var Pt=x(()=>{"use strict"});function Ln(e){if(e.type!=="FRAME"&&e.type!=="COMPONENT"&&e.type!=="INSTANCE")return!1;let n=e;if("width"in n&&"height"in n){let t=n.width,o=n.height;if(t<10||o<10||t>1e4||o>1e4)return!1}return"children"in n?n.children.length>0:!0}function Fn(e,n,t){let o=e*n*t*t;return Math.ceil(o*4)}function $n(e){if(e.length===0)return null;let n=[],t=[],o=[],i=[];for(let r of e)r.type==="FRAME"?n.push(r):r.type==="COMPONENT"?t.push(r):r.type==="INSTANCE"?o.push(r):i.push(r);let s=n.filter(Ln);return s.length>0?(s.sort((r,a)=>{let l="width"in r&&"height"in r?r.width*r.height:0;return("width"in a&&"height"in a?a.width*a.height:0)-l}),s[0]):n.length>0?n[0]:t.length>0?t[0]:o.length>0?o[0]:i.length>0?i[0]:e[0]}async function Lt(e={}){let{maxImages:n=1,imageScale:t=2,preferFrames:o=!0,maxWidth:i=4096,maxHeight:s=4096,maxSizeBytes:r=20*1024*1024}=e,a=figma.currentPage.selection;if(a.length===0)return[];let l=[];if(o){let c=$n(a);c?l=[c]:l=[...a]}else l=[...a];l=l.slice(0,n);let u=[];for(let c of l)try{let d,m,g=t;if("width"in c&&"height"in c){d=c.width,m=c.height;let O=d*g,R=m*g;if(O>i||R>s){let M=i/d,h=s/m;if(g=Math.min(M,h,t),g<.5){console.warn(`[Export] Node ${c.id} too large, skipping export`);continue}}if(Fn(d,m,g)>r){let M=r/4,h=Math.sqrt(M/(d*m));if(g=Math.min(g,h),g<.5){console.warn(`[Export] Node ${c.id} would exceed size limit, skipping export`);continue}}}let p=await c.exportAsync({format:"PNG",constraint:{type:"SCALE",value:g}});if(p.length>r){console.warn(`[Export] Exported image for node ${c.id} exceeds size limit (${p.length} bytes), skipping`);continue}let S=`data:image/png;base64,${figma.base64Encode(p)}`,b,C;d&&m&&(b=Math.round(d*g),C=Math.round(m*g)),u.push({dataUrl:S,name:c.name||"Unnamed",width:b,height:C}),console.log(`[Export] Successfully exported ${c.name||"Unnamed"}: ${b}x${C}px at ${g}x scale, ${Math.round(p.length/1024)}KB`)}catch(d){console.error(`[Export] Failed to export node ${c.id} (${c.name||"Unnamed"}):`,d)}return u}var Ft=x(()=>{"use strict"});async function xe(e){var l,u;let{selectionOrder:n,quickAction:t,provider:o}=e,i=W(n),s={selection:i};i.hasSelection&&(s.selectionSummary=Dt(kt(n)));let r=(t==null?void 0:t.requiresVision)===!0,a=o.capabilities.supportsImages;if(r&&a&&i.hasSelection)try{let c=(l=t.maxImages)!=null?l:1,d=(u=t.imageScale)!=null?u:2,m=await Lt({maxImages:c,imageScale:d,preferFrames:!0});if(m.length>0){let g=o.capabilities.maxImages;g!==void 0?s.images=m.slice(0,g):s.images=m,console.log(`[SelectionContext] Exported ${s.images.length} image(s) for vision analysis`),s.images.forEach((p,f)=>{let S=p.dataUrl.length*.75,b=p.dataUrl.substring(0,80)+"...";console.log(`[SelectionContext] Image ${f+1}: ${p.name||"Unnamed"}, ${p.width}x${p.height}, ~${Math.round(S/1024)}KB, preview: ${b}`)})}else console.warn("[SelectionContext] Vision required but no images exported - continuing with summary only")}catch(c){console.error("[SelectionContext] Failed to export images (continuing with summary only):",c)}return s}var $t=x(()=>{"use strict";ze();Pt();Ft()});var Ut={};ee(Ut,{computePlacement:()=>le,getAbsoluteBounds:()=>_t,getAnchorBounds:()=>ae,getTopLevelContainerNode:()=>H});function H(e){let n=e;for(;n&&n.parent;){if(n.parent.type==="PAGE")return n;n=n.parent}return e}function _t(e){let n=null;if("absoluteBoundingBox"in e&&e.absoluteBoundingBox){let t=e.absoluteBoundingBox;n={x:t.x,y:t.y,width:t.width,height:t.height}}else if("absoluteRenderBounds"in e&&e.absoluteRenderBounds){let t=e.absoluteRenderBounds;n={x:t.x,y:t.y,width:t.width,height:t.height}}else if("absoluteTransform"in e&&"width"in e&&"height"in e){let t=e.absoluteTransform,o=t[0][2],i=t[1][2],s=e.width,r=e.height;typeof o=="number"&&typeof i=="number"&&typeof s=="number"&&typeof r=="number"&&!isNaN(o)&&!isNaN(i)&&!isNaN(s)&&!isNaN(r)&&s>0&&r>0&&(n={x:o,y:i,width:s,height:r})}else if("x"in e&&"y"in e&&"width"in e&&"height"in e){let t=0,o=0,i=e;for(;i&&!(!i.parent||i.parent.type==="PAGE"||i.parent.type==="DOCUMENT");){if("x"in i&&"y"in i){let l=i;t+=l.x,o+=l.y}i=i.parent}let s=e,r=s.width,a=s.height;typeof t=="number"&&typeof o=="number"&&typeof r=="number"&&typeof a=="number"&&!isNaN(t)&&!isNaN(o)&&!isNaN(r)&&!isNaN(a)&&r>0&&a>0&&(n={x:t,y:o,width:r,height:a})}return n&&n.x===0&&n.y===0&&e.parent&&e.parent.type!=="PAGE"?(console.warn(`[getAbsoluteBounds] Rejecting (0,0) bounds for node ${e.name} with parent ${e.parent.type}`),null):n}function ae(e){return _t(e)}function le(e,n,t,o={}){var c,d,m;let i=(c=o.mode)!=null?c:"left",s=(d=o.offset)!=null?d:40,r=(m=o.minX)!=null?m:0;if(!e){let g=figma.viewport.center,p=g.x-n/2,f=g.y-t/2;return{x:Math.max(p,r),y:Math.max(f,40)}}let a,l;switch(i){case"left":a=e.x-n-s,l=e.y;break;case"right":a=e.x+e.width+s,l=e.y;break;case"above":a=e.x,l=e.y-t-s;break;case"below":a=e.x,l=e.y+e.height+s;break;case"center":a=e.x+e.width/2-n/2,l=e.y+e.height/2-t/2;break;default:a=e.x-n-s,l=e.y}return a=Math.max(a,r),l=Math.max(l,40),{x:a,y:l}}var Q=x(()=>{"use strict"});async function ce(){let e={regular:{family:"Inter",style:"Regular"},bold:{family:"Inter",style:"Bold"},italic:{family:"Inter",style:"Italic"},boldItalic:{family:"Inter",style:"Bold Italic"}};try{await figma.loadFontAsync(e.regular),await figma.loadFontAsync(e.bold),await figma.loadFontAsync(e.italic);try{await figma.loadFontAsync(e.boldItalic)}catch(n){e.boldItalic=e.bold}}catch(n){try{e.regular={family:"Roboto",style:"Regular"},e.bold={family:"Roboto",style:"Bold"},e.italic={family:"Roboto",style:"Italic"},e.boldItalic={family:"Roboto",style:"Bold Italic"},await figma.loadFontAsync(e.regular),await figma.loadFontAsync(e.bold),await figma.loadFontAsync(e.italic);try{await figma.loadFontAsync(e.boldItalic)}catch(t){e.boldItalic=e.bold}}catch(t){e.regular={family:"Inter",style:"Regular"},e.bold=e.regular,e.italic=e.regular,e.boldItalic=e.regular}}return e}function qt(e,n,t,o,i){let s=figma.createFrame();return s.name=e,s.x=n,s.y=t,s.resize(o,i),s}async function A(e,n={}){var i,s;let t=await ce(),o=figma.createText();return o.name="Text",o.fontName=(i=n.fontName)!=null?i:t.regular,o.fontSize=(s=n.fontSize)!=null?s:12,o.characters=e,o.textAutoResize="HEIGHT",n.fills&&(o.fills=n.fills),n.lineHeight&&(o.lineHeight=n.lineHeight),n.letterSpacing&&(o.letterSpacing=n.letterSpacing),n.textAlign&&(o.textAlignHorizontal=n.textAlign),o}var Be=x(()=>{"use strict"});async function zt(e){let n=await ce();await figma.loadFontAsync({family:"Inter",style:"Semi Bold"});let t=640,o=16,i=12,s=20,r=qt("FigmAI \u2014 Scorecard",0,0,t,100);r.fills=[{type:"SOLID",color:{r:.98,g:.98,b:.98}}],r.strokes=[{type:"SOLID",color:{r:.85,g:.85,b:.85}}],r.strokeWeight=1,r.cornerRadius=8;let a=o,l=figma.createFrame();l.name="Header",l.resize(t-o*2,30),l.x=o,l.y=a,l.fills=[],r.appendChild(l);let u=await A("Design Critique",{fontSize:16,fontName:n.bold,fills:[{type:"SOLID",color:{r:.2,g:.2,b:.2}}]});u.x=0,u.y=0,l.appendChild(u);let c=figma.createFrame();c.name="Score Badge",c.resize(80,28),c.x=t-o*2-80,c.y=1,c.cornerRadius=12;let d={r:.96,g:.62,b:.04};c.fills=[{type:"SOLID",color:{r:d.r*.15,g:d.g*.15,b:d.b*.15}}],c.strokes=[{type:"SOLID",color:d,opacity:.3}],c.strokeWeight=1;let m=await A(`${Z.score}`,{fontSize:14,fontName:n.bold,fills:[{type:"SOLID",color:d}]});m.x=12,m.y=6,c.appendChild(m);let g=await A("/100",{fontSize:12,fontName:n.regular,fills:[{type:"SOLID",color:{r:.5,g:.5,b:.5}}]});g.x=m.x+m.width+4,g.y=7,c.appendChild(g),l.appendChild(c),a+=l.height+i;let p=await A("Placeholder (no LLM)",{fontSize:11,fontName:n.italic,fills:[{type:"SOLID",color:{r:.5,g:.5,b:.5}}]});p.x=o,p.y=a,p.resize(t-o*2,p.height),r.appendChild(p),a+=p.height+s;let f=await A(Z.summary,{fontSize:13,fontName:n.regular,fills:[{type:"SOLID",color:{r:.3,g:.3,b:.3}}]});f.x=o,f.y=a,f.resize(t-o*2,f.height),r.appendChild(f),a+=f.height+s;let S=await A("Wins",{fontSize:14,fontName:{family:"Inter",style:"Semi Bold"},fills:[{type:"SOLID",color:{r:.16,g:.73,b:.51}}]});S.x=o,S.y=a,r.appendChild(S),a+=S.height+8;for(let h of Z.wins){let y=await A(`\u2022 ${h}`,{fontSize:12,fontName:n.regular,fills:[{type:"SOLID",color:{r:.2,g:.2,b:.2}}]});y.x=o,y.y=a,y.resize(t-o*2,y.height),r.appendChild(y),a+=y.height+6}a+=s-6;let b=await A("Fixes",{fontSize:14,fontName:{family:"Inter",style:"Semi Bold"},fills:[{type:"SOLID",color:{r:.96,g:.62,b:.04}}]});b.x=o,b.y=a,r.appendChild(b),a+=b.height+8;for(let h of Z.fixes){let y=await A(`\u2022 ${h}`,{fontSize:12,fontName:n.regular,fills:[{type:"SOLID",color:{r:.2,g:.2,b:.2}}]});y.x=o,y.y=a,y.resize(t-o*2,y.height),r.appendChild(y),a+=y.height+6}a+=s-6;let C=await A("Checklist",{fontSize:14,fontName:{family:"Inter",style:"Semi Bold"},fills:[{type:"SOLID",color:{r:.2,g:.2,b:.2}}]});C.x=o,C.y=a,r.appendChild(C),a+=C.height+8;for(let h of Z.checklist){let y=await A(h,{fontSize:12,fontName:n.regular,fills:[{type:"SOLID",color:{r:.2,g:.2,b:.2}}]});y.x=o,y.y=a,y.resize(t-o*2,y.height),r.appendChild(y),a+=y.height+6}a+=s-6;let O=await A("Notes",{fontSize:14,fontName:{family:"Inter",style:"Semi Bold"},fills:[{type:"SOLID",color:{r:.5,g:.5,b:.5}}]});O.x=o,O.y=a,r.appendChild(O),a+=O.height+8;for(let h of Z.notes){let y=await A(`\u2022 ${h}`,{fontSize:12,fontName:n.regular,fills:[{type:"SOLID",color:{r:.2,g:.2,b:.2}}]});y.x=o,y.y=a,y.resize(t-o*2,y.height),r.appendChild(y),a+=y.height+6}a+=o,r.resize(t,a);let R=e?H(e):void 0,T=R?ae(R):null,M=le(T,r.width,r.height,{mode:"left",offset:40});r.x=M.x,r.y=M.y,figma.currentPage.appendChild(r),figma.currentPage.selection=[r],figma.viewport.scrollAndZoomIntoView([r])}var Z,Bt=x(()=>{"use strict";Q();Be();Z={score:82,summary:"This is a placeholder scorecard for visual design iteration. It demonstrates the scorecard layout without calling the LLM.",wins:["Clear visual hierarchy with consistent spacing","Strong color contrast meets WCAG AA standards","Interactive elements have clear affordances"],fixes:["Increase text contrast for body text (currently #666, suggest #333)","Add 8px spacing between related form fields to improve grouping","Make hover states more obvious with visual feedback"],checklist:["\u2713 Primary action is visually dominant","\u2713 Related elements are grouped using spacing","\u2717 Interactive elements need hover states","\u2713 Text is readable without zooming"],notes:["Overall solid design with room for improvement in micro-interactions","Consider adding loading states for async actions"]}});var Jt={};ee(Jt,{computeAnchorBoundsForArtifact:()=>Vt,findExistingArtifactsByType:()=>jt,getTopLevelContainerNodeForArtifact:()=>Ht,placeArtifactFrame:()=>He,removeExistingArtifacts:()=>J});function jt(e,n,t){let o=[];function i(s){if(s.type==="FRAME"){let r=s;r.name.startsWith("FigmAI Artifact \u2014 ")&&r.getPluginData("figmai.artifactType")===n&&(t!==void 0?r.getPluginData("figmai.artifactVersion")===t&&o.push(r):o.push(r))}if("children"in s)for(let r of s.children)i(r)}return i(e),o}function J(e,n){let t=figma.currentPage,o=jt(t,e,n);if(e==="critique"){let s=r=>{if(r.type==="FRAME"){let a=r;if(a.name==="FigmAI \u2014 Critique"||a.name==="FigmAI \u2014 Critique (fallback)"){let l=a.getPluginData("figmai.artifactType");(l==="critique"||!l)&&o.push(a)}}if("children"in r)for(let a of r.children)s(a)};s(t)}let i=Array.from(new Set(o));for(let s of i)s.remove();if(i.length>0){let s=n?` (${n})`:"";console.log(`[Artifacts] Removed ${i.length} existing artifact(s) of type: ${e}${s}`)}}async function He(e){var S,b,C,O,R;let{type:n,assistant:t,selectedNode:o,width:i=640,spacing:s=40,version:r,replace:a=!0}=e;a&&J(n,r);let l=figma.createFrame(),u=n.charAt(0).toUpperCase()+n.slice(1);r?l.name=`FigmAI Artifact \u2014 ${u} (${r})`:l.name=`FigmAI Artifact \u2014 ${u}`,l.layoutMode="VERTICAL",l.primaryAxisSizingMode="AUTO",l.counterAxisSizingMode="FIXED",l.resize(i,100),l.paddingTop=0,l.paddingRight=0,l.paddingBottom=0,l.paddingLeft=0,l.itemSpacing=0,l.setPluginData("figmai.artifactType",n),l.setPluginData("figmai.assistant",t),r&&l.setPluginData("figmai.artifactVersion",r);let c,d=null,m="none";if(o){c=Ht(o),d=Vt(c),d&&("absoluteBoundingBox"in c&&c.absoluteBoundingBox?m="bbox":"absoluteRenderBounds"in c&&c.absoluteRenderBounds?m="renderBounds":"absoluteTransform"in c&&"width"in c&&"height"in c?m="transform":"x"in c&&"y"in c&&"width"in c&&"height"in c?m="relative":m="none"),d&&console.log("[ArtifactPlacement] raw bounds values",{x:d.x,y:d.y,width:d.width,height:d.height,method:m,anchorHasTransform:"absoluteTransform"in c,anchorTransform:"absoluteTransform"in c?c.absoluteTransform:null,anchorHasBbox:"absoluteBoundingBox"in c,anchorBbox:"absoluteBoundingBox"in c?c.absoluteBoundingBox:null,anchorHasRenderBounds:"absoluteRenderBounds"in c,anchorRenderBounds:"absoluteRenderBounds"in c?c.absoluteRenderBounds:null,anchorRelativePos:"x"in c&&"y"in c?{x:c.x,y:c.y}:null}),d&&(d.x===0||d.x<600)&&(console.warn(`[ArtifactPlacement] Invalid bounds: x=${d.x} too small for left placement, using viewport center`),d=null);let M=((S=o.parent)==null?void 0:S.type)==="PAGE";console.log("[ArtifactPlacement] selectedNode -> anchor -> bounds",{selectedNode:{name:o.name,id:o.id,type:o.type,parentType:(b=o.parent)==null?void 0:b.type},isDirectChild:M,anchor:{name:c.name,id:c.id,type:c.type,parentType:(C=c.parent)==null?void 0:C.type},boundsUsedMethod:m,bounds:d?{x:d.x,y:d.y,width:d.width,height:d.height}:null})}else console.log("[ArtifactPlacement] selectedNode -> anchor -> bounds",{selectedNode:null,anchor:null,boundsUsedMethod:"none",bounds:null,reason:"no_selection"});figma.currentPage.appendChild(l);let g=d&&d.x>=l.width+s,p="anchor",f=null;if(g){f=le(d,l.width,l.height,{mode:"left",offset:s,minX:0});let T=0,M=40,h=Math.max(f.x,T),y=Math.max(f.y,M);l.x=h,l.y=y}else{p="viewport",console.warn(`[ArtifactPlacement] Anchor at x=${d==null?void 0:d.x} too close to left edge (need ${l.width+s}), using viewport center`);let T=figma.viewport.center,M=Math.max(T.x-l.width/2,0),h=Math.max(T.y-l.height/2,40);l.x=M,l.y=h}return console.log("[ArtifactPlacement] placement",{method:p,computedXBeforeClamp:(O=f==null?void 0:f.x)!=null?O:null,computedYBeforeClamp:(R=f==null?void 0:f.y)!=null?R:null,computedXAfterClamp:l.x,computedYAfterClamp:l.y,rootWidth:l.width,rootHeight:l.height,anchorBounds:d?{x:d.x,y:d.y,width:d.width,height:d.height}:null,offset:s,mode:"left",clampedX:f?l.x!==f.x:!1,clampedY:f?l.y!==f.y:!1,reason:g?null:`Anchor x=${d==null?void 0:d.x} < required ${l.width+s}`}),figma.currentPage.selection=[l],figma.viewport.scrollAndZoomIntoView([l]),l}var Ht,Vt,Ae=x(()=>{"use strict";Q();Ht=H,Vt=ae});function _n(e,n,t){let i=60*n;return e.length<=i?e:e.substring(0,i-3)+"..."}function Un(e){return!e.parent||e.parent.type!=="FRAME"?!1:e.parent.layoutMode!=="NONE"}function F(e){var n,t;if(!(e.type!=="FRAME"&&e.type!=="COMPONENT"&&e.type!=="INSTANCE"&&e.type!=="TEXT")){if(!Un(e)){let o=((n=e.parent)==null?void 0:n.type)==="FRAME"?e.parent.name:"none",i=((t=e.parent)==null?void 0:t.type)==="FRAME"?e.parent.layoutMode:"NONE";console.log(`[safeSetFillX] Skipping FILL for ${e.name} (${e.type}): parent=${o}, layoutMode=${i}`);return}(e.type==="FRAME"||e.type==="COMPONENT"||e.type==="INSTANCE"||e.type==="TEXT")&&(e.layoutSizingHorizontal="FILL")}}function N(e){e.setPluginData("figmai.buildScope","scorecard_v2")}function qn(e){let n=figma.currentPage,t=[];for(let o of n.children){if(o===e)continue;if(o.getPluginData("figmai.buildScope")==="scorecard_v2"&&t.push(o),o.name==="Header"&&o.type==="FRAME"){let s=o.getPluginData("figmai.artifactType");(!s||s==="")&&t.push(o)}}for(let o of t)console.warn(`[renderScorecardV2] Removing stray node: ${o.name} (${o.id})`),o.remove();t.length>0&&console.log(`[renderScorecardV2] Cleaned up ${t.length} stray node(s)`)}async function zn(e,n,t){let o=figma.createFrame();o.name="Header",o.layoutMode="HORIZONTAL",o.primaryAxisSizingMode="AUTO",o.counterAxisSizingMode="AUTO",o.primaryAxisAlignItems="SPACE_BETWEEN",o.counterAxisAlignItems="CENTER",N(o),e.appendChild(o),F(o);let i=figma.createFrame();i.name="Title Column",i.layoutMode="VERTICAL",i.primaryAxisSizingMode="AUTO",i.counterAxisSizingMode="AUTO",i.itemSpacing=4,N(i),o.appendChild(i);let s=await A("Design Critique",{fontSize:22,fontName:t.bold,fills:[{type:"SOLID",color:{r:0,g:0,b:0}}]});N(s),i.appendChild(s);let r=await A("Heuristic evaluation",{fontSize:12,fontName:t.regular,fills:[{type:"SOLID",color:{r:.42,g:.45,b:.5}}]});if(N(r),i.appendChild(r),n.score!==null){let a=figma.createFrame();a.name="Score Badge",a.layoutMode="HORIZONTAL",a.primaryAxisSizingMode="AUTO",a.counterAxisSizingMode="AUTO",a.paddingTop=6,a.paddingRight=12,a.paddingBottom=6,a.paddingLeft=12,a.cornerRadius=999,N(a),o.appendChild(a);let l,u;n.score>=85?(l={r:.91,g:.97,b:.93},u={r:.09,g:.4,b:.2}):n.score>=70?(l={r:1,g:.97,b:.93},u={r:.6,g:.2,b:.07}):(l={r:1,g:.88,b:.88},u={r:.6,g:.11,b:.11}),a.fills=[{type:"SOLID",color:l}];let c=await A(`${n.score} / 100`,{fontSize:13,fontName:t.bold,fills:[{type:"SOLID",color:u}]});N(c),a.appendChild(c)}return o}async function Bn(e,n,t){if(!n.summary)return null;let o=await A(_n(n.summary,3,14),{fontSize:14,fontName:t.regular,fills:[{type:"SOLID",color:{r:.07,g:.09,b:.15}}]});return N(o),e.appendChild(o),F(o),o}async function Hn(e,n,t){let o=figma.createFrame();if(o.name="Two Column Body",o.layoutMode="HORIZONTAL",o.primaryAxisSizingMode="AUTO",o.counterAxisSizingMode="AUTO",o.itemSpacing=16,N(o),e.appendChild(o),F(o),n.wins.length>0){let i=await Wt("Wins",n.wins.slice(0,4),n.wins.length,t,o);F(i)}if(n.fixes.length>0){let i=await Wt("Fixes",n.fixes.slice(0,4),n.fixes.length,t,o);F(i)}return o}async function Vn(e,n,t){if(n.checklist.length===0)return null;let o=figma.createFrame();o.name="Checklist",o.layoutMode="VERTICAL",o.primaryAxisSizingMode="AUTO",o.counterAxisSizingMode="AUTO",o.itemSpacing=8,N(o),e.appendChild(o),F(o);let i=await A("Checklist",{fontSize:14,fontName:t.bold,fills:[{type:"SOLID",color:{r:0,g:0,b:0}}]});N(i),o.appendChild(i);let s=n.checklist.slice(0,5);for(let r of s){let a=figma.createFrame();a.name="Checklist Row",a.layoutMode="HORIZONTAL",a.primaryAxisSizingMode="AUTO",a.counterAxisSizingMode="AUTO",a.itemSpacing=8,a.counterAxisAlignItems="CENTER",N(a),o.appendChild(a),F(a);let l=r.trim().startsWith("\u2713")||r.trim().startsWith("\u2714"),u=l?"\u2713":"\u2715",c=r.replace(/^[]\s*/,"").trim(),d=await A(u,{fontSize:14,fontName:t.bold,fills:[{type:"SOLID",color:l?{r:.16,g:.73,b:.51}:{r:.94,g:.27,b:.27}}]});N(d),a.appendChild(d);let m=await A(c,{fontSize:13,fontName:t.regular,fills:[{type:"SOLID",color:{r:.2,g:.2,b:.2}}]});N(m),a.appendChild(m),F(m)}if(n.checklist.length>5){let r=await A(`+ ${n.checklist.length-5} more`,{fontSize:12,fontName:t.regular,fills:[{type:"SOLID",color:{r:.5,g:.5,b:.5}}]});N(r),o.appendChild(r)}return o}async function jn(e,n,t){if(!n.notes||n.notes.length===0)return null;let o=figma.createFrame();o.name="Notes",o.layoutMode="VERTICAL",o.primaryAxisSizingMode="AUTO",o.counterAxisSizingMode="AUTO",o.itemSpacing=6,N(o),e.appendChild(o),F(o);let i=await A("Notes",{fontSize:14,fontName:t.bold,fills:[{type:"SOLID",color:{r:.5,g:.5,b:.5}}]});N(i),o.appendChild(i);let s=n.notes.slice(0,2);for(let r of s){let a=await A(`\u2022 ${r}`,{fontSize:13,fontName:t.regular,fills:[{type:"SOLID",color:{r:.4,g:.4,b:.4}}]});N(a),o.appendChild(a),F(a)}return o}async function Wt(e,n,t,o,i){let s=figma.createFrame();s.name=e,s.layoutMode="VERTICAL",s.primaryAxisSizingMode="AUTO",s.counterAxisSizingMode="AUTO",s.itemSpacing=8,N(s),i.appendChild(s);let r=await A(e,{fontSize:14,fontName:o.bold,fills:[{type:"SOLID",color:{r:0,g:0,b:0}}]});N(r),s.appendChild(r);let a=figma.createFrame();a.name="Divider",a.layoutMode="HORIZONTAL",a.primaryAxisSizingMode="AUTO",a.counterAxisSizingMode="FIXED",a.resize(100,1),a.fills=[{type:"SOLID",color:{r:.9,g:.9,b:.9}}],N(a),s.appendChild(a),F(a);for(let l of n){let u=await A(`\u2022 ${l}`,{fontSize:13,fontName:o.regular,fills:[{type:"SOLID",color:{r:.2,g:.2,b:.2}}]});N(u),s.appendChild(u),F(u)}if(t>4){let l=await A(`+ ${t-4} more`,{fontSize:12,fontName:o.regular,fills:[{type:"SOLID",color:{r:.5,g:.5,b:.5}}]});N(l),s.appendChild(l)}return s}async function de(e,n,t){let o=(t==null?void 0:t.runId)||"unknown";console.log(`[DC ${o}] renderScorecardV2 ENTER`);let i=!0,s=null;try{s=await He({type:"scorecard",assistant:"design_critique",selectedNode:n,width:560,spacing:40,version:"v2",replace:!0});let r=await ce();if(await figma.loadFontAsync({family:"Inter",style:"Semi Bold"}),s.layoutMode="VERTICAL",s.paddingTop=20,s.paddingRight=20,s.paddingBottom=20,s.paddingLeft=20,s.itemSpacing=16,s.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],s.strokes=[{type:"SOLID",color:{r:.9,g:.9,b:.9}}],s.strokeWeight=1,s.cornerRadius=16,i&&console.log("[renderScorecardV2] Building header..."),await zn(s,e,r),i&&console.log("[renderScorecardV2] Header built, root.children:",s.children.map(l=>l.name)),e.summary&&(i&&console.log("[renderScorecardV2] Building summary..."),await Bn(s,e,r),i&&console.log("[renderScorecardV2] Summary built, root.children:",s.children.map(l=>l.name))),(e.wins.length>0||e.fixes.length>0)&&(i&&console.log("[renderScorecardV2] Building two-column body..."),await Hn(s,e,r),i&&console.log("[renderScorecardV2] Two-column body built, root.children:",s.children.map(l=>l.name))),e.checklist.length>0&&(i&&console.log("[renderScorecardV2] Building checklist..."),await Vn(s,e,r),i&&console.log("[renderScorecardV2] Checklist built, root.children:",s.children.map(l=>l.name))),e.notes&&e.notes.length>0&&(i&&console.log("[renderScorecardV2] Building notes..."),await jn(s,e,r),i&&console.log("[renderScorecardV2] Notes built, root.children:",s.children.map(l=>l.name))),s.children.length===0)throw new Error("v2 scorecard rendered empty - no children appended to root");i&&(console.log("[renderScorecardV2] \u2705 Build complete, root.children:",s.children.map(l=>l.name)),console.log("[renderScorecardV2] Root has",s.children.length,"direct children")),qn(s);let a=figma.currentPage;for(let l of a.children)if(l!==s&&l.name==="Header"&&l.type==="FRAME"){let u=l.getPluginData("figmai.artifactType");(!u||u==="")&&(console.error(`[renderScorecardV2] \u274C Found stray Header node at page root: ${l.id}`),l.remove())}return figma.currentPage.selection=[s],figma.viewport.scrollAndZoomIntoView([s]),console.log(`[DC ${o}] renderScorecardV2 EXIT`,{childCount:s.children.length,rootName:s.name,rootId:s.id}),s}catch(r){if(console.error("[renderScorecardV2] Error during render:",r),s)try{s.remove(),console.log("[renderScorecardV2] Removed root frame due to error")}catch(u){console.error("[renderScorecardV2] Failed to remove root:",u)}let a=figma.currentPage,l=[];for(let u of a.children)u.getPluginData("figmai.buildScope")==="scorecard_v2"&&l.push(u);for(let u of l)try{u.remove(),console.log(`[renderScorecardV2] Removed stray node: ${u.name}`)}catch(c){console.error(`[renderScorecardV2] Failed to remove stray node ${u.name}:`,c)}throw r}}var Ve=x(()=>{"use strict";Ae();Be()});function Gt(e){let n=e;for(;n;){if(n.type==="INSTANCE"){let t=n,o=t.mainComponent;if(o){let i=t.variantProperties&&Object.keys(t.variantProperties).length>0?Object.fromEntries(Object.entries(t.variantProperties).map(([s,r])=>[s,typeof r=="string"?r:String(r)])):void 0;return{kind:"instance",name:o.name,key:o.key,variantProperties:i}}}else if(n.type==="COMPONENT"){let t=n;return{kind:"component",name:t.name,key:t.key}}else if(n.type==="COMPONENT_SET"){let t=n;return{kind:"componentSet",name:t.name,key:t.key}}if(n.parent){if(n.parent.type==="PAGE"||n.parent.type==="DOCUMENT")break;if("visible"in n.parent)n=n.parent;else break}else break}return{kind:"custom",name:"Custom"}}function je(e){try{let n=figma.fileKey;if(!n)return`figma://node-id=${e.replace(/:/g,"-")}`;let t=encodeURIComponent(e);return`https://www.figma.com/file/${n}?node-id=${t}`}catch(n){return console.warn("[Scanner] Failed to build canonical Figma URL:",n),`figma://node-id=${e.replace(/:/g,"-")}`}}function Jn(e){return[...e].sort((n,t)=>{let o=n.y-t.y;return Math.abs(o)>1?o:n.x-t.x})}function Xt(e,n){let t=e.name.toLowerCase(),o=e.characters.toLowerCase();if(t.includes("error")||o.includes("error")||t.includes("invalid"))return"Error";if(t.includes("cta")||t.includes("button")||t.includes("action"))return"CTA";if(t.includes("headline")||t.includes("title")||t.includes("heading"))return"Headline";if(t.includes("placeholder")||o.includes("enter")||o.includes("type"))return"Placeholder";if(t.includes("tooltip")||t.includes("hint"))return"Tooltip";if(t.includes("helper")||t.includes("help")||t.includes("description"))return"Helper";if(t.includes("body")||t.includes("text")||t.includes("content"))return"Body"}function Yt(e){try{return new RegExp(e)}catch(n){return console.warn(`[ContentTable] Invalid regex pattern ignored: "${e}"`,n),null}}function Kt(e,n,t){if(!t)return!1;if(t.nodeNamePatterns&&t.nodeNamePatterns.length>0)for(let o of t.nodeNamePatterns){let i=Yt(o);if(i&&i.test(e.name))return!0}if(t.nodeIdPrefixes&&t.nodeIdPrefixes.length>0){for(let o of t.nodeIdPrefixes)if(e.id.startsWith(o))return!0}if(t.componentKeyAllowlist&&t.componentKeyAllowlist.length>0&&(!n.key||!t.componentKeyAllowlist.includes(n.key))||t.componentKeyDenylist&&t.componentKeyDenylist.length>0&&n.key&&t.componentKeyDenylist.includes(n.key))return!0;if(t.textValuePatterns&&t.textValuePatterns.length>0)for(let o of t.textValuePatterns){let i=Yt(o);if(i&&i.test(e.characters))return!0}return!1}function Qt(e,n,t=[],o=null,i,s=new Map,r={}){var l,u,c;if(!e.visible)return;let a=null;if(i)if(s.has(e.id))a=(l=s.get(e.id))!=null?l:null;else{let d=e.type;if(d==="FRAME"||d==="INSTANCE"||d==="COMPONENT"||d==="COMPONENT_SET"||d==="TEXT")try{a=i(e)}catch(m){console.warn(`[ContentTable] Design system detection failed for node ${e.id}:`,m),a=null}s.set(e.id,a),a&&a.isDesignSystem&&(r[e.id]=a)}if(e.type==="TEXT"){let d=e,m=Gt(d);if(Kt(d,m,o))return;let g=t.length>0?t.join(" / "):d.name,p=je(d.id),f=Xt(d,g),S=(u=s.get(d.id))!=null?u:null,b={id:d.id,nodeId:d.id,nodeUrl:p,component:m,field:{label:d.name,path:g,role:f},content:{type:"text",value:d.characters},textLayerName:d.name,meta:{visible:d.visible!==!1,locked:d.locked===!0},notes:"",contentKey:"",jiraTicket:"",adaNotes:"",errorMessage:f==="Error"?d.characters:"",designSystem:S&&S.isDesignSystem?S:void 0};n.push(b)}if("children"in e){let d=Jn(e.children);for(let m of d)if(m.visible){if(m.type==="TEXT"){let g=m,p=Gt(g);if(Kt(g,p,o))continue;let f=null;if(i)if(s.has(g.id))f=(c=s.get(g.id))!=null?c:null;else{try{f=i(g)}catch(T){console.warn(`[ContentTable] Design system detection failed for node ${g.id}:`,T),f=null}s.set(g.id,f),f&&f.isDesignSystem&&(r[g.id]=f)}let b=[...t,g.name].join(" / "),C=je(g.id),O=Xt(g,b),R={id:g.id,nodeId:g.id,nodeUrl:C,component:p,field:{label:g.name,path:b,role:O},content:{type:"text",value:g.characters},textLayerName:g.name,meta:{visible:g.visible!==!1,locked:g.locked===!0},notes:"",contentKey:"",jiraTicket:"",adaNotes:"",errorMessage:O==="Error"?g.characters:"",designSystem:f&&f.isDesignSystem?f:void 0};n.push(R)}else if("children"in m){let g=[...t,m.name];Qt(m,n,g,o,i,s,r)}}}}async function Wn(e){try{let t="width"in e?e.width:100,o=Math.min(1,100/t),i=await e.exportAsync({format:"PNG",constraint:{type:"SCALE",value:o}});return`data:image/png;base64,${figma.base64Encode(i)}`}catch(n){console.warn("[Scanner] Failed to export thumbnail:",n);return}}async function Zt(e,n=null,t){let o=e.parent,i=o&&o.type==="PAGE"?o.name:"Unknown Page",s=o&&o.type==="PAGE"?o.id:"",r=[],a=new Map,l={};Qt(e,r,[e.name],n,t,a,l);let u=await Wn(e),c=je(e.id),d={contentModel:"Universal v2",contentStage:"Draft",adaStatus:"\u23F3 Pending",legalStatus:"\u23F3 Pending",lastUpdated:new Date().toISOString(),version:"v1",rootNodeId:e.id,rootNodeName:e.name,rootNodeUrl:c,thumbnailDataUrl:u},m={type:"universal-content-table",version:1,generatedAtISO:new Date().toISOString(),source:{pageId:s,pageName:i,selectionNodeId:e.id,selectionName:e.name},meta:d,items:r};return Object.keys(l).length>0&&(m.designSystemByNodeId=l),m}var en=x(()=>{"use strict"});function ue(){return{confluenceApi:void 0,createConfluence:void 0,designSystem:void 0,auth:void 0,getContentTableIgnoreRules:void 0,detectDesignSystemComponent:void 0,postProcessContentTable:void 0}}var Je=x(()=>{"use strict"});var tn={};ee(tn,{default:()=>Xn});var Gn,Xn,nn=x(()=>{"use strict";Je();Gn=ue(),Xn=Gn});async function on(){try{let e=await Promise.resolve().then(()=>(nn(),tn));return e.default&&typeof e.default=="object"?(Te&&console.log("[WorkAdapter] Loaded override via default export"),e.default):"createWorkAdapter"in e&&typeof e.createWorkAdapter=="function"?(Te&&console.log("[WorkAdapter] Loaded override via createWorkAdapter()"),e.createWorkAdapter()):(Te&&console.warn("[WorkAdapter] Override module loaded but no valid export found, using default"),ue())}catch(e){return Te&&console.log("[WorkAdapter] No override file found, using default adapter:",e instanceof Error?e.message:String(e)),ue()}}var Te,rn=x(()=>{"use strict";Je();Te=!1});function sn(e){let n=[],t=[];if(!e||typeof e!="object")return t.push("Table is not an object"),{ok:!1,warnings:n,errors:t};let o=e;if(o.type!=="universal-content-table"&&t.push('Missing or invalid type field (must be "universal-content-table")'),(typeof o.version!="number"||o.version!==1)&&t.push("Missing or invalid version field (must be 1)"),(!o.generatedAtISO||typeof o.generatedAtISO!="string")&&t.push("Missing or invalid generatedAtISO field"),!o.source||typeof o.source!="object")t.push("Missing or invalid source field");else{let s=o.source;typeof s.pageId!="string"&&t.push("source.pageId is missing or invalid"),typeof s.pageName!="string"&&t.push("source.pageName is missing or invalid"),typeof s.selectionNodeId!="string"&&t.push("source.selectionNodeId is missing or invalid"),typeof s.selectionName!="string"&&t.push("source.selectionName is missing or invalid")}if(!o.meta||typeof o.meta!="object")t.push("Missing or invalid meta field");else{let s=o.meta,r=["contentModel","contentStage","adaStatus","legalStatus","lastUpdated","version","rootNodeId","rootNodeName","rootNodeUrl"];for(let a of r)typeof s[a]!="string"&&t.push(`meta.${a} is missing or invalid`)}return Array.isArray(o.items)?(o.items.forEach((s,r)=>{if(!s||typeof s!="object"){t.push(`items[${r}] is not an object`);return}let a=s,l=["id","nodeId","nodeUrl","component","field","content","meta"];for(let u of l)u in a||t.push(`items[${r}].${u} is missing`);if(a.component&&typeof a.component=="object"){let u=a.component;typeof u.kind!="string"&&t.push(`items[${r}].component.kind is missing or invalid`),typeof u.name!="string"&&t.push(`items[${r}].component.name is missing or invalid`)}if(a.field&&typeof a.field=="object"){let u=a.field;typeof u.label!="string"&&t.push(`items[${r}].field.label is missing or invalid`),typeof u.path!="string"&&t.push(`items[${r}].field.path is missing or invalid`)}if(a.content&&typeof a.content=="object"){let u=a.content;u.type!=="text"&&t.push(`items[${r}].content.type is missing or invalid (must be "text")`),typeof u.value!="string"&&t.push(`items[${r}].content.value is missing or invalid`)}if(a.meta&&typeof a.meta=="object"){let u=a.meta;typeof u.visible!="boolean"&&t.push(`items[${r}].meta.visible is missing or invalid`),typeof u.locked!="boolean"&&t.push(`items[${r}].meta.locked is missing or invalid`)}}),o.designSystemByNodeId!==void 0&&(typeof o.designSystemByNodeId!="object"||Array.isArray(o.designSystemByNodeId)||o.designSystemByNodeId===null)&&t.push("designSystemByNodeId must be an object map (Record<string, DesignSystemDetectionResult>)"),Yn&&(n.length>0&&console.warn("[ContentTableValidation] Warnings:",n),t.length>0&&console.error("[ContentTableValidation] Errors:",t)),{ok:t.length===0,warnings:n,errors:t}):(t.push("items is not an array"),{ok:t.length===0,warnings:n,errors:t})}function an(e){var t,o;let n=JSON.parse(JSON.stringify(e));return Array.isArray(n.items)||(n.items=[]),n.meta||(n.meta={contentModel:"Universal v2",contentStage:"Draft",adaStatus:"\u23F3 Pending",legalStatus:"\u23F3 Pending",lastUpdated:new Date().toISOString(),version:"v1",rootNodeId:((t=n.source)==null?void 0:t.selectionNodeId)||"",rootNodeName:((o=n.source)==null?void 0:o.selectionName)||"",rootNodeUrl:""}),n.source||(n.source={pageId:"",pageName:"Unknown Page",selectionNodeId:"",selectionName:"Unknown Selection"}),n.items=n.items.map((i,s)=>{let r=$({},i);return r.id||(r.id=r.nodeId||`item_${s}`),r.nodeId||(r.nodeId=r.id),r.nodeUrl||(r.nodeUrl=""),r.component?r.component={kind:r.component.kind||"custom",name:r.component.name||"Unknown Component",key:r.component.key,variantProperties:r.component.variantProperties}:r.component={kind:"custom",name:"Unknown Component"},r.field?r.field={label:r.field.label||"Unknown Field",path:r.field.path||"",role:r.field.role}:r.field={label:"Unknown Field",path:""},r.content?r.content={type:r.content.type||"text",value:r.content.value||""}:r.content={type:"text",value:""},r.meta?r.meta={visible:typeof r.meta.visible=="boolean"?r.meta.visible:!0,locked:typeof r.meta.locked=="boolean"?r.meta.locked:!1}:r.meta={visible:!0,locked:!1},r.textLayerName=r.textLayerName,r.notes=r.notes,r.contentKey=r.contentKey,r.jiraTicket=r.jiraTicket,r.adaNotes=r.adaNotes,r.errorMessage=r.errorMessage,r.designSystem=r.designSystem,r}),n.designSystemByNodeId!==void 0&&n.designSystemByNodeId!==null&&(typeof n.designSystemByNodeId!="object"||Array.isArray(n.designSystemByNodeId))&&delete n.designSystemByNodeId,n}var Yn,ln=x(()=>{"use strict";fe();Yn=z.dev.enableContentTableValidationLogging});var Ne,cn=x(()=>{"use strict";en();rn();ln();Ne=class{canHandle(n,t){return n==="content_table"&&t==="generate-table"}async handleResponse(n){var s;let{selectionOrder:t,sendAssistantMessage:o}=n;if(t.length===0){let r="Select a single container to scan.";return o(r),figma.notify(r),{handled:!0}}if(t.length>1){let r="Only one selection allowed. Select a single container.";return o(r),figma.notify(r),{handled:!0}}let i=figma.getNodeById(t[0]);if(!i){let r="Selected node not found.";return o(r),figma.notify(r),{handled:!0}}if(i.type==="DOCUMENT"||i.type==="PAGE"){let r="Please select a container (frame, component, etc.), not a page or document.";return o(r),figma.notify(r),{handled:!0}}try{o("Scanning...");let r=await on(),a=((s=r.getContentTableIgnoreRules)==null?void 0:s.call(r))||null,l=r.detectDesignSystemComponent,u=await Zt(i,a,l);if(r.postProcessContentTable)try{let m={pageId:u.source.pageId,pageName:u.source.pageName,rootNodeId:u.meta.rootNodeId};u=await r.postProcessContentTable({table:u,selectionContext:m}),console.log("[ContentTableHandler] Content table post-processed by Work adapter")}catch(m){console.error("[ContentTableHandler] Error in postProcessContentTable hook:",m)}u=an(u);let c=sn(u);!c.ok&&c.errors.length>0&&console.error("[ContentTableHandler] Content table validation errors:",c.errors),c.warnings.length>0&&console.warn("[ContentTableHandler] Content table validation warnings:",c.warnings);let d=u.items.length;return d===0?o("No text items found in the selected container."):(o(`Found ${d} text item${d===1?"":"s"}`),o("Table generated")),figma.ui.postMessage({pluginMessage:{type:"CONTENT_TABLE_GENERATED",table:u}}),console.log("[ContentTableHandler] Content table generated:",d,"items"),{handled:!0}}catch(r){let a=r instanceof Error?r.message:"Unknown error";return o(`Error: ${a}`),figma.notify(`Error generating table: ${a}`),figma.ui.postMessage({pluginMessage:{type:"CONTENT_TABLE_ERROR",error:a}}),{handled:!0}}}}});function Kn(e){let n=e.trim();try{let c=JSON.parse(n);if(typeof c=="object"&&c!==null)return n}catch(c){}let t=n.match(/```(?:json)?\s*([\s\S]*?)```/);if(t&&t[1]){let c=t[1].trim();try{return JSON.parse(c),c}catch(d){}}let o=n.indexOf("{");if(o===-1)return null;let i=0,s=!1,r=!1,a=o,l=-1;for(let c=o;c<n.length;c++){let d=n[c];if(r){r=!1;continue}if(d==="\\"){r=!0;continue}if(d==='"'){s=!s;continue}if(!s){if(d==="{")i++;else if(d==="}"&&(i--,i===0)){l=c;break}}}if(i!==0||l===-1)return null;let u=n.substring(a,l+1).trim();try{return JSON.parse(u),u}catch(c){return null}}function We(e,n=!1){var a,l,u;let t=e.trim();n&&console.log("[parseScorecardJson] Raw response (first 500 chars):",t.substring(0,500));let o=Kn(t);if(!o){let c=t.match(/```(?:json)?\s*([\s\S]*?)```/)?"code fence":"balanced JSON";return n&&console.log("[parseScorecardJson] \u274C Failed to extract JSON, method attempted:",c),{error:"No valid JSON object found in response"}}if(n){let c=t.startsWith("{")?"direct":t.match(/```(?:json)?\s*([\s\S]*?)```/)?"code fence":"balanced";console.log("[parseScorecardJson] \u2705 JSON extracted, method:",c)}let i;try{i=JSON.parse(o)}catch(c){return n&&console.log("[parseScorecardJson] \u274C JSON parse error:",c),{error:"JSON parse error: "+(c instanceof Error?c.message:String(c))}}n&&console.log("[parseScorecardJson] Parsed top-level keys:",Object.keys(i));let s=(a=i.score)!=null?a:i.overallScore;if(s==null)return n&&console.log("[parseScorecardJson] \u274C Validation failure: Missing score field"),{error:"Missing required field: score"};if(typeof s!="number")return n&&console.log("[parseScorecardJson] \u274C Validation failure: score is not a number:",typeof s,s),{error:"Invalid score: must be a number"};if(s<0||s>100)return n&&console.log("[parseScorecardJson] \u274C Validation failure: score out of range:",s),{error:`Invalid score: must be between 0 and 100, got ${s}`};if(!Array.isArray(i.wins))return n&&console.log("[parseScorecardJson] \u274C Validation failure: wins is not an array:",typeof i.wins),{error:"Missing or invalid wins: must be an array"};if(!Array.isArray(i.fixes))return n&&console.log("[parseScorecardJson] \u274C Validation failure: fixes is not an array:",typeof i.fixes),{error:"Missing or invalid fixes: must be an array"};let r={score:s,summary:typeof i.summary=="string"?i.summary:"",wins:i.wins.map(c=>String(c)),fixes:i.fixes.map(c=>String(c)),checklist:Array.isArray(i.checklist)?i.checklist.map(c=>String(c)):[],notes:Array.isArray(i.notes)?i.notes.map(c=>String(c)):void 0};return n&&(console.log("[parseScorecardJson] \u2705 Validation passed"),console.log("[parseScorecardJson] Score:",r.score),console.log("[parseScorecardJson] Wins:",r.wins.length),console.log("[parseScorecardJson] Fixes:",r.fixes.length),console.log("[parseScorecardJson] Checklist:",r.checklist.length),console.log("[parseScorecardJson] Notes:",(u=(l=r.notes)==null?void 0:l.length)!=null?u:0)),{data:r}}var dn=x(()=>{"use strict"});function Qn(e){let n=e.split(`
`),t=[],o=[],i=0;for(let r=0;r<n.length;r++){let a=n[r],l=i,u=0;if(a.match(/^#{1,3}\s+/)){let h=a.match(/^(#{1,3})\s+/);h&&(u=h[1].length,a=a.replace(/^#{1,3}\s+/,""))}let c=/^[-*]\s+/.test(a),d=a.match(/^\d+\.\s+/),m=!!d;if(c)a=a.replace(/^[-*]\s+/,"\u2022 ");else if(m){let h=d[0].replace(/\s+$/,"");a=a.replace(/^\d+\.\s+/,`${h} `)}let g=/\*\*([^*]+)\*\*/g,p=[],f;for(;(f=g.exec(a))!==null;)p.push({start:f.index,end:f.index+f[0].length,text:f[1]});let S=new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)","g"),b=[],C;for(;(C=S.exec(a))!==null;)p.some(y=>C.index>=y.start&&C.index<y.end)||b.push({start:C.index,end:C.index+C[0].length,text:C[1]});let O=new RegExp("(?<!_)_([^_]+)_(?!_)","g"),R;for(;(R=O.exec(a))!==null;)p.some(y=>R.index>=y.start&&R.index<y.end)||b.push({start:R.index,end:R.index+R[0].length,text:R[1]});let T=a;for(let h of p.reverse()){T=T.substring(0,h.start)+h.text+T.substring(h.end);for(let y of p)y.start>h.start&&(y.start-=2,y.end-=2);for(let y of b)y.start>h.start&&(y.start-=2,y.end-=2)}for(let h of b.reverse())if(T.substring(h.start,h.end).includes("*")||T.substring(h.start,h.end).includes("_")){let y=(T[h.start]==="*",1);T=T.substring(0,h.start)+h.text+T.substring(h.end);for(let D of p)D.start>h.start&&(D.start-=y,D.end-=y);for(let D of b)D.start>h.start&&(D.start-=y,D.end-=y)}t.push(T);let M=i;for(let h of p){let y=M+h.start,D=y+h.text.length;b.some(q=>q.start<h.end&&q.end>h.start||h.start<q.end&&h.end>q.start)?o.push({start:y,end:D,style:"boldItalic"}):o.push({start:y,end:D,style:"bold"})}for(let h of b){let y=M+h.start,D=y+h.text.length;p.some(q=>q.start<h.end&&q.end>h.start||h.start<q.end&&h.end>q.start)||o.push({start:y,end:D,style:"italic"})}if(u>0&&T.trim().length>0){let h=M,y=h+T.length;o.push({start:h,end:y,style:"bold",size:u===1?18:u===2?16:14})}i+=T.length+1}return{text:t.join(`
`),spans:o.sort((r,a)=>r.start-a.start)}}async function Ge(e,n,t){let o=t||"unknown";console.log(`[DC ${o}] placeCritiqueOnCanvas ENTER`,{selectedNode:n?{name:n.name,id:n.id}:null});let{getTopLevelContainerNodeForArtifact:i,computeAnchorBoundsForArtifact:s}=await Promise.resolve().then(()=>(Ae(),Jt)),{computePlacement:r}=await Promise.resolve().then(()=>(Q(),Ut)),a=2e4,l=e;e.length>a&&(l=e.substring(0,a)+`

(truncated)`);let u=Qn(l),c={regular:{family:"Inter",style:"Regular"},bold:{family:"Inter",style:"Bold"},italic:{family:"Inter",style:"Italic"},boldItalic:{family:"Inter",style:"Bold Italic"}};try{await figma.loadFontAsync(c.regular),await figma.loadFontAsync(c.bold),await figma.loadFontAsync(c.italic);try{await figma.loadFontAsync(c.boldItalic)}catch(S){c.boldItalic=c.bold}}catch(S){try{c.regular={family:"Roboto",style:"Regular"},c.bold={family:"Roboto",style:"Bold"},c.italic={family:"Roboto",style:"Italic"},c.boldItalic={family:"Roboto",style:"Bold Italic"},await figma.loadFontAsync(c.regular),await figma.loadFontAsync(c.bold),await figma.loadFontAsync(c.italic);try{await figma.loadFontAsync(c.boldItalic)}catch(b){c.boldItalic=c.bold}}catch(b){c.regular={family:"Inter",style:"Regular"},c.bold=c.regular,c.italic=c.regular,c.boldItalic=c.regular}}let d=figma.createFrame();d.name="FigmAI \u2014 Critique (fallback)",d.setPluginData("figmai.artifactType","critique"),d.setPluginData("figmai.assistant","design_critique");let m=figma.createText();m.name="Critique Text",m.fontName=c.regular,m.fontSize=12,m.characters=u.text,m.textAutoResize="HEIGHT",m.setRangeFontName(0,u.text.length,c.regular);for(let S of u.spans)if(S.start<u.text.length&&S.end<=u.text.length&&S.start<S.end){let b;switch(S.style){case"bold":b=c.bold;break;case"italic":b=c.italic;break;case"boldItalic":b=c.boldItalic;break;default:b=c.regular}m.setRangeFontName(S.start,S.end,b),S.size&&m.setRangeFontSize(S.start,S.end,S.size)}m.resize(640,m.height),d.appendChild(m),d.resize(m.width,m.height);let g,p=null;n?(g=i(n),p=s(g),console.log(`[DC ${o}] placeCritiqueOnCanvas anchor`,{selectedNode:{name:n.name,id:n.id},anchor:{name:g.name,id:g.id},anchorBounds:p?{x:p.x,y:p.y,width:p.width,height:p.height}:null})):console.log(`[DC ${o}] placeCritiqueOnCanvas anchor`,{selectedNode:null,anchor:null,anchorBounds:null});let f=r(p,d.width,d.height,{mode:"left",offset:40,minX:0});return d.x=f.x,d.y=f.y,console.log(`[DC ${o}] placeCritiqueOnCanvas placement`,{computedX:f.x,computedY:f.y,frameWidth:d.width,frameHeight:d.height}),figma.currentPage.appendChild(d),figma.currentPage.selection=[d],figma.viewport.scrollAndZoomIntoView([d]),console.log(`[DC ${o}] placeCritiqueOnCanvas EXIT`,{frameName:d.name,frameId:d.id}),d}var un=x(()=>{"use strict"});var Ce,mn=x(()=>{"use strict";dn();Ve();Ae();un();Q();Ce=class{canHandle(n,t){return n==="design_critique"&&t==="give-critique"}prepareMessages(n){return[{role:"system",content:"Return ONLY valid JSON. No prose. No markdown. No code fences. Output must be a single JSON object."},...n,{role:"user",content:"IMPORTANT: Output must be a single JSON object with keys: score (0-100), summary (string), wins (string[]), fixes (string[]), checklist (string[] optional), notes (string[] optional). Do not include any other keys. Return JSON only, no other text."}]}async handleResponse(n){var l,u,c,d;let{response:t,selectionOrder:o,selection:i,provider:s,sendAssistantMessage:r}=n,a=`dc_${Date.now()}`;console.log(`[DC ${a}] START`,{assistantId:n.assistantId,quickActionId:n.actionId});try{let m;if(i.hasSelection&&o.length>0){let p=figma.getNodeById(o[0]);if(p&&p.type!=="DOCUMENT"&&p.type!=="PAGE"){m=p;let f=H(m),S=((l=m.parent)==null?void 0:l.type)==="PAGE";console.log(`[DC ${a}] selectedNode`,{name:m.name,id:m.id,type:m.type,parentType:(u=m.parent)==null?void 0:u.type,isDirectChild:S}),console.log(`[DC ${a}] computed anchor`,{name:f.name,id:f.id,type:f.type,parentType:(c=f.parent)==null?void 0:c.type,isTopLevel:((d=f.parent)==null?void 0:d.type)==="PAGE"})}else console.log(`[DC ${a}] selectedNode`,{status:"invalid_or_missing",nodeType:p==null?void 0:p.type})}else console.log(`[DC ${a}] selectedNode`,{status:"no_selection"});console.log(`[DC ${a}] RAW_RESPONSE_HEAD`,t.slice(0,120)),console.log(`[DC ${a}] RAW_RESPONSE_LENGTH`,t.length),console.log(`[DC ${a}] BEFORE removeExistingArtifacts`),J("scorecard","v2"),J("critique"),console.log(`[DC ${a}] AFTER removeExistingArtifacts`),console.log(`[DC ${a}] BEFORE parseScorecardJson`);let g=We(t,!0);if("data"in g){console.log(`[DC ${a}] parseScorecardJson RESULT`,{status:"SUCCESS",score:g.data.score,wins:g.data.wins.length,fixes:g.data.fixes.length}),console.log(`[DC ${a}] BEFORE renderScorecardV2`);try{return await de(g.data,m,{runId:a}),console.log(`[DC ${a}] AFTER renderScorecardV2`,{status:"SUCCESS"}),figma.notify("Scorecard placed (v2)"),figma.ui.postMessage({pluginMessage:{type:"SCORECARD_PLACED",success:!0,message:"Scorecard placed on stage"}}),{handled:!0}}catch(p){throw console.log(`[DC ${a}] CATCH renderScorecardV2`,{error:p instanceof Error?p.message:String(p),stack:p instanceof Error?p.stack:void 0}),p}}else{console.log(`[DC ${a}] parseScorecardJson RESULT`,{status:"FAIL",error:g.error}),console.log(`[DC ${a}] BEFORE repair attempt`);try{let p=`Convert the following critique into ONLY valid JSON with the required schema. Return JSON only, no other text.

Required schema:
{
  "score": 0-100 (number),
  "summary": "string",
  "wins": ["string"],
  "fixes": ["string"],
  "checklist": ["string"] (optional),
  "notes": ["string"] (optional)
}

Critique text:
${t.substring(0,2e3)}`,f=[{role:"system",content:"Return ONLY valid JSON. No prose. No markdown. No code fences. Output must be a single JSON object."},{role:"user",content:p}],S=await s.sendChat({messages:f,assistantId:n.assistantId,assistantName:"Design Critique",quickActionId:n.actionId});console.log(`[DC ${a}] repair response length:`,S.length),console.log(`[DC ${a}] repair response head:`,S.substring(0,120));let b=We(S,!0);if("data"in b)return console.log(`[DC ${a}] repair RESULT`,{status:"SUCCESS",score:b.data.score}),console.log(`[DC ${a}] BEFORE renderScorecardV2 (from repair)`),await de(b.data,m,{runId:a}),console.log(`[DC ${a}] AFTER renderScorecardV2 (from repair)`,{status:"SUCCESS"}),figma.notify("Scorecard placed (v2, repaired)"),figma.ui.postMessage({pluginMessage:{type:"SCORECARD_PLACED",success:!0,message:"Scorecard placed on stage"}}),{handled:!0};console.log(`[DC ${a}] repair RESULT`,{status:"FAIL",error:b.error})}catch(p){console.log(`[DC ${a}] repair CATCH`,{error:p instanceof Error?p.message:String(p)})}return console.log(`[DC ${a}] BEFORE placeCritiqueOnCanvas fallback`),await Ge(t,m,a),console.log(`[DC ${a}] AFTER placeCritiqueOnCanvas fallback`,{status:"SUCCESS"}),figma.notify("Scorecard parse failed \u2014 placed critique fallback"),figma.ui.postMessage({pluginMessage:{type:"SCORECARD_PLACED",success:!0,message:"Scorecard placed on stage"}}),{handled:!0}}}catch(m){console.log(`[DC ${a}] CATCH handler`,{error:m instanceof Error?m.message:String(m),stack:m instanceof Error?m.stack:void 0});let g=m instanceof Error?m.message:"Unknown error processing critique";try{J("scorecard","v2"),J("critique")}catch(p){console.error(`[DC ${a}] Failed to cleanup artifacts:`,p)}try{let p;if(i.hasSelection&&o.length>0){let f=figma.getNodeById(o[0]);f&&f.type!=="DOCUMENT"&&f.type!=="PAGE"&&(p=f)}return console.log(`[DC ${a}] BEFORE placeCritiqueOnCanvas error fallback`),await Ge(t,p,a),console.log(`[DC ${a}] AFTER placeCritiqueOnCanvas error fallback`),figma.notify("Error processing critique \u2014 placed critique fallback"),figma.ui.postMessage({pluginMessage:{type:"SCORECARD_PLACED",success:!0,message:"Scorecard placed on stage"}}),{handled:!0}}catch(p){return console.error(`[DC ${a}] Fallback placement also failed:`,p),figma.notify(`Error: ${g}`),{handled:!0,message:`Error: ${g}`}}}}}});function gn(e,n){return Zn.find(t=>t.canHandle(e,n))}var Zn,fn=x(()=>{"use strict";cn();mn();Zn=[new Ne,new Ce]});var hn={};ee(hn,{default:()=>to});function Ee(e){if(e instanceof _)switch(e.type){case"authentication":return"Authentication failed. Please check your token in Settings.";case"rate_limit":return"Rate limit exceeded. Please try again in a moment.";case"network":return`Network error: ${e.message}`;case"timeout":return"Request timeout. The server took too long to respond. Please try again.";case"invalid_request":return`Invalid request: ${e.message}`;case"provider_error":return e.statusCode&&e.statusCode>=500?`Server error (${e.statusCode}): The server encountered an error. Please try again later.`:`Provider error: ${e.message}`;default:return e.message}if(e instanceof Error)return e.message;if(e&&typeof e=="object"&&"status"in e&&"statusText"in e){let n=e;return`HTTP ${n.status}: ${n.statusText}`}if(e&&typeof e=="object")try{let n=JSON.stringify(e,null,2);return n.length>500?n.substring(0,500)+"...":n}catch(n){return String(e)}return String(e)}async function eo(){try{I=await B(V)}catch(e){console.error("[Main] Failed to initialize provider:",e);let{StubProvider:n}=await Promise.resolve().then(()=>(ke(),lt));I=new n}}function X(){return`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function we(){let e=W(w);figma.ui.postMessage({pluginMessage:{type:"SELECTION_STATE",state:e}})}function k(e,n){let t={id:X(),role:"assistant",content:e,timestamp:Date.now(),toolCallId:n};j.push(t),figma.ui.postMessage({pluginMessage:{type:"ASSISTANT_MESSAGE",message:t}})}function pn(e,n,t){let o={id:X(),role:"tool",content:e,timestamp:Date.now(),toolCallId:n};j.push(o),figma.ui.postMessage({pluginMessage:{type:"TOOL_RESULT",message:o,data:t}})}function to(){ve({height:600,width:400,title:ot.brandName}),figma.on("selectionchange",function(){let n=figma.currentPage.selection,t=new Set(n.map(i=>i.id)),o=new Set(w);w=w.filter(i=>t.has(i));for(let i of n)o.has(i.id)||w.push(i.id);we()}),w=figma.currentPage.selection.map(n=>n.id),we()}var G,yn,V,I,j,w,Sn=x(()=>{"use strict";nt();rt();fe();st();bt();ne();Mt();ze();$t();re();ie();Bt();Ve();fn();Q();G=Oe(),yn=z.defaultMode,V=z.provider,I=null,j=[],w=[];eo();Re("RESET",async function(){j=[],G=Oe(),yn=z.defaultMode,V=z.provider,I=await B(V),w=[];let e={id:X(),role:"assistant",content:G.intro,timestamp:Date.now()};j.push(e),figma.ui.postMessage({pluginMessage:{type:"ASSISTANT_MESSAGE",message:e}}),we(),figma.ui.postMessage({pluginMessage:{type:"RESET_DONE"}})});v("REQUEST_SELECTION_STATE",function(){console.log("[Main] onmessage REQUEST_SELECTION_STATE"),we()});v("SET_ASSISTANT",function(e){console.log("[Main] onmessage SET_ASSISTANT",{assistantId:e});let n=Me(e);if(n){G=n;let t={id:X(),role:"assistant",content:n.intro,timestamp:Date.now()};j.push(t),console.log("[Main] postMessage ASSISTANT_MESSAGE (assistant intro)"),figma.ui.postMessage({pluginMessage:{type:"ASSISTANT_MESSAGE",message:t}})}});v("SET_MODE",function(e){yn=e});v("SET_LLM_PROVIDER",async function(e){V=e,I=await B(e)});v("SEND_MESSAGE",async function(e,n){console.log("[Main] onmessage SEND_MESSAGE",{messageLength:e.length,includeSelection:n});let t={id:X(),role:"user",content:e,timestamp:Date.now()};j.push(t);let o;if(n&&I&&(o=await xe({selectionOrder:w,quickAction:void 0,provider:I})),G.kind==="tool"){k(`Tool-only assistant "${G.label}" is active. Tool execution would happen here.`);return}let i=ye(j.filter(s=>s.role==="user"||s.role==="assistant").map(s=>({role:s.role,content:s.content})));try{I||(I=await B(V),n&&(o=await xe({selectionOrder:w,quickAction:void 0,provider:I})));let s=await I.sendChat({messages:i,assistantId:G.id,assistantName:G.label,selection:o==null?void 0:o.selection,selectionSummary:o==null?void 0:o.selectionSummary,images:o==null?void 0:o.images,quickActionId:void 0});k(s)}catch(s){let r=Ee(s);k(`Error: ${r}`)}});v("RUN_QUICK_ACTION",async function(e,n){console.log("[Main] onmessage RUN_QUICK_ACTION",{actionId:e,assistantId:n});try{let t=Me(n);if(!t){console.error("[Main] Assistant not found:",n),k(`Error: Assistant "${n}" not found`);return}let o=t.quickActions.find(u=>u.id===e);if(!o){console.error("[Main] Action not found:",e,"for assistant:",n),k(`Error: Action "${e}" not found`);return}let i=gn(n,e);if(i&&n==="content_table"&&e==="generate-table"){let u={assistantId:n,actionId:e,response:"",selectionOrder:w,selection:W(w),provider:I||await B(V),sendAssistantMessage:k};if((await i.handleResponse(u)).handled)return}if(n==="code2design"){if(e==="send-json"||e==="get-json")return;if(e==="json-format-help"){k(`**FigmAI Template JSON Format**

**Schema Version:** 1.0

**Required Top-Level Keys:**
- \`schemaVersion\`: Must be "1.0"
- \`root\`: The root template node

**Supported Node Types (v1):**
- \`FRAME\`: Container with optional auto-layout
- \`TEXT\`: Text node with content
- \`RECTANGLE\`: Rectangle shape

**Safety Limits:**
- Maximum depth: 12 levels
- Maximum nodes: 300
- Invalid JSON will not modify the canvas

**Example Structure:**
\`\`\`json
{
  "schemaVersion": "1.0",
  "meta": { "name": "My Design" },
  "root": {
    "type": "FRAME",
    "name": "Card",
    "layout": { "mode": "AUTO_LAYOUT", "direction": "VERTICAL" },
    "children": [...]
  }
}
\`\`\`

Use SEND JSON to import or GET JSON to export your designs.`);return}}let s=W(w);if(o.requiresSelection&&!s.hasSelection){k("Error: This action requires a selection. Please select one or more nodes first.");return}if(o.requiresVision&&!s.hasSelection){k("Error: This action requires a selection to analyze. Please select a frame or design element first.");return}let r={id:X(),role:"user",content:o.templateMessage,timestamp:Date.now()};if(j.push(r),console.log("[Main] Sending user message to UI (single source of truth):",r.id),figma.ui.postMessage({pluginMessage:{type:"ASSISTANT_MESSAGE",message:r}}),t.kind==="tool"){k(`Tool-only assistant "${t.label}" is active. Tool execution would happen here.`);return}let a=ye(j.filter(u=>u.role==="user"||u.role==="assistant").map(u=>({role:u.role,content:u.content})));if(i&&i.prepareMessages){let u=i.prepareMessages(a);u&&(a=u,t.id==="design_critique"&&o.id==="give-critique"&&console.log("[DC] FINAL_MESSAGES",a.map(c=>({role:c.role,contentPreview:c.content.substring(0,120)}))))}let l;I||(I=await B(V)),l=await xe({selectionOrder:w,quickAction:o,provider:I}),l.selectionSummary?console.log("[Main] Selection summary for quick action:",l.selectionSummary.substring(0,200)+"..."):console.log("[Main] No selection summary - hasSelection:",l.selection.hasSelection);try{if(t.id==="design_critique"&&o.id==="give-critique"&&(console.log("[DC] Calling provider.sendChat with:"),console.log("[DC] assistantId=",t.id),console.log("[DC] quickActionId=",o.id),console.log("[DC] hasSelection=",l.selection.hasSelection),l.selection.hasSelection&&w.length>0)){let d=figma.getNodeById(w[0]);if(d&&d.type!=="DOCUMENT"&&d.type!=="PAGE"){let m=H(d);console.log("[DC] selectedNode=",d.name,"id=",d.id),console.log("[DC] anchor=",m.name,"id=",m.id)}}let u=await I.sendChat({messages:a,assistantId:t.id,assistantName:t.label,selection:o.requiresSelection?l.selection:void 0,selectionSummary:l.selectionSummary,images:l.images,quickActionId:o.id}),c=!1;if(i){let d={assistantId:t.id,actionId:o.id,response:u,selectionOrder:w,selection:l.selection,provider:I,sendAssistantMessage:k};(await i.handleResponse(d)).handled&&(c=!0)}c||k(u)}catch(u){let c=Ee(u);k(`Error: ${c}`)}}catch(t){console.error("[Main] Unhandled error in RUN_QUICK_ACTION:",t);let o=t instanceof Error?t.message:"Unknown error";k(`Error: ${o}`)}});v("RUN_TOOL",async function(e,n){let t=W(w),o=await vt({id:X(),name:e,arguments:n},t),i;if(e==="EXPORT_SELECTION_TO_TEMPLATE_JSON"&&o.startsWith("JSON_EXPORT:"))try{i={exportedJson:o.replace("JSON_EXPORT:","")};let r=o.includes("frame(s)")?`Exported ${(t==null?void 0:t.count)||0} frame(s) to JSON template.`:"Exported selection to JSON template.";pn(r,e,i);return}catch(s){}pn(o,e,i)});v("SAVE_SETTINGS",async function(e){try{await mt(e),I=await B(V)}catch(n){let t=Ee(n);figma.ui.postMessage({pluginMessage:{type:"TEST_RESULT",success:!1,message:`Failed to save settings: ${t}`}})}});v("REQUEST_SETTINGS",async function(){try{let e=await P();figma.ui.postMessage({pluginMessage:{type:"SETTINGS_RESPONSE",settings:e}})}catch(e){figma.ui.postMessage({pluginMessage:{type:"SETTINGS_RESPONSE",settings:await P()}})}});v("TEST_PROXY_CONNECTION",async function(){try{I||(I=await B(V));let e=await I.testConnection();figma.ui.postMessage({pluginMessage:{type:"TEST_RESULT",success:e.success,message:e.message}})}catch(e){let n=Ee(e);figma.ui.postMessage({pluginMessage:{type:"TEST_RESULT",success:!1,message:`Connection test failed: ${n}`}})}});v("COPY_TABLE_STATUS",function(e,n){console.log("[Main] onmessage COPY_TABLE_STATUS",{status:e,message:n}),e==="success"?figma.notify(n||"Successfully copied table to clipboard"):e==="error"&&figma.notify(n||"Failed to copy table. See console for details.")});v("RUN_PLACEHOLDER_SCORECARD",async function(){console.log("[Main] RUN_PLACEHOLDER_SCORECARD received");try{let e;if(w.length>0){let n=figma.getNodeById(w[0]);n&&n.type!=="DOCUMENT"&&n.type!=="PAGE"&&(e=n)}await zt(e),figma.ui.postMessage({pluginMessage:{type:"PLACEHOLDER_SCORECARD_PLACED"}}),figma.notify("Placeholder scorecard added to stage")}catch(e){console.error("[Main] Error rendering placeholder scorecard:",e);let n=e instanceof Error?e.message:"Unknown error";figma.ui.postMessage({pluginMessage:{type:"PLACEHOLDER_SCORECARD_ERROR",message:n}}),figma.notify(`Error: ${n}`)}});v("RUN_SCORECARD_V2_PLACEHOLDER",async function(){console.log("[Main] RUN_SCORECARD_V2_PLACEHOLDER received");try{let e;if(w.length>0){let t=figma.getNodeById(w[0]);t&&t.type!=="DOCUMENT"&&t.type!=="PAGE"&&(e=t)}await de({score:82,summary:"This is a placeholder scorecard v2 for visual design iteration. It demonstrates the new 2-column layout with colored score pill and tighter card design.",wins:["Clear visual hierarchy with consistent spacing","Strong color contrast meets WCAG AA standards","Interactive elements have clear affordances","Responsive layout adapts well to different screen sizes"],fixes:["Increase text contrast for body text (currently #666, suggest #333)","Add 8px spacing between related form fields to improve grouping","Make hover states more obvious with visual feedback","Consider adding loading states for async actions"],checklist:["\u2713 Primary action is visually dominant","\u2713 Related elements are grouped using spacing","\u2717 Interactive elements need hover states","\u2713 Text is readable without zooming","\u2713 Color palette is accessible"],notes:["Overall solid design with room for improvement in micro-interactions","Consider adding loading states for async actions"]},e),figma.ui.postMessage({pluginMessage:{type:"PLACEHOLDER_SCORECARD_PLACED"}}),figma.notify("Scorecard v2 (placeholder) added to stage")}catch(e){console.error("[Main] Error rendering scorecard v2 placeholder:",e);let n=e instanceof Error?e.message:"Unknown error";figma.ui.postMessage({pluginMessage:{type:"PLACEHOLDER_SCORECARD_ERROR",message:n}}),figma.notify(`Error: ${n}`)}});v("EXPORT_CONTENT_TABLE_REF_IMAGE",async function(e){console.log("[Main] EXPORT_CONTENT_TABLE_REF_IMAGE received",{rootNodeId:e});try{let n=figma.getNodeById(e);if(!n){console.error("[Main] Export Ref Image: Node not found for rootNodeId:",e),figma.ui.postMessage({pluginMessage:{type:"CONTENT_TABLE_REF_IMAGE_ERROR",message:"Root node not found"}});return}if(n.type==="DOCUMENT"||n.type==="PAGE"){console.error("[Main] Export Ref Image: Cannot export document or page"),figma.ui.postMessage({pluginMessage:{type:"CONTENT_TABLE_REF_IMAGE_ERROR",message:"Cannot export document or page as image"}});return}let t=n,o;try{o=await t.exportAsync({format:"PNG",constraint:{type:"WIDTH",value:600}})}catch(r){console.warn("[Main] Export Ref Image: WIDTH constraint failed, trying SCALE:",r);let a="width"in t?t.width:600,l=Math.min(1,600/a);o=await t.exportAsync({format:"PNG",constraint:{type:"SCALE",value:l}})}console.log("[Main] Export Ref Image: Export succeeded, bytes length:",o.length);let s=`data:image/png;base64,${figma.base64Encode(o)}`;console.log("[Main] Export Ref Image: Sending READY, dataUrl length:",s.length),figma.ui.postMessage({pluginMessage:{type:"CONTENT_TABLE_REF_IMAGE_READY",dataUrl:s}})}catch(n){let t=n instanceof Error?n.message:"Unknown error";console.error("[Main] Export Ref Image: Failed to export ref image:",n),figma.ui.postMessage({pluginMessage:{type:"CONTENT_TABLE_REF_IMAGE_ERROR",message:`Could not export reference image: ${t}`}})}})});var no={"src/main.ts--default":(Sn(),In(hn)).default},oo="src/main.ts--default";no[oo]();
